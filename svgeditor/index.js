/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function __rest(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(i[o[s]]=e[o[s]])}return i}function __decorate(e,t,i,o){var s,n=arguments.length,a=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(s=e[r])&&(a=(n<3?s(a):n>3?s(t,i,a):s(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a}function __awaiter(e,t,i,o){return new(i||(i=Promise))((function(s,n){function a(e){try{l(o.next(e))}catch(e){n(e)}}function r(e){try{l(o.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((o=o.apply(e,t||[])).next())}))}function __classPrivateFieldGet(e,t,i,o){if("a"===i&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?o:"a"===i?o.call(e):o?o.value:t.get(e)}function __classPrivateFieldSet(e,t,i,o,s){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?s.call(e,i):s?s.value=i:t.set(e,i),i
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */}const t$2=window.ShadowRoot&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,e$3=Symbol(),n$5=new Map;class s$3{constructor(e,t){if(this._$cssResult$=!0,t!==e$3)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e}get styleSheet(){let e=n$5.get(this.cssText);return t$2&&void 0===e&&(n$5.set(this.cssText,e=new CSSStyleSheet),e.replaceSync(this.cssText)),e}toString(){return this.cssText}}const o$3=e=>new s$3("string"==typeof e?e:e+"",e$3),r$2=(e,...t)=>{const i=1===e.length?e[0]:t.reduce(((t,i,o)=>t+(e=>{if(!0===e._$cssResult$)return e.cssText;if("number"==typeof e)return e;throw Error("Value passed to 'css' function must be a 'css' function result: "+e+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+e[o+1]),e[0]);return new s$3(i,e$3)},i$2=(e,t)=>{t$2?e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):t.forEach((t=>{const i=document.createElement("style"),o=window.litNonce;void 0!==o&&i.setAttribute("nonce",o),i.textContent=t.cssText,e.appendChild(i)}))},S$1=t$2?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const i of e.cssRules)t+=i.cssText;return o$3(t)})(e):e
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */;var s$2;const e$2=window.trustedTypes,r$1=e$2?e$2.emptyScript:"",h$1=window.reactiveElementPolyfillSupport,o$2={toAttribute(e,t){switch(t){case Boolean:e=e?r$1:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let i=e;switch(t){case Boolean:i=null!==e;break;case Number:i=null===e?null:Number(e);break;case Object:case Array:try{i=JSON.parse(e)}catch(e){i=null}}return i}},n$4=(e,t)=>t!==e&&(t==t||e==e),l$2={attribute:!0,type:String,converter:o$2,reflect:!1,hasChanged:n$4};class a$1 extends HTMLElement{constructor(){super(),this._$Et=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Ei=null,this.o()}static addInitializer(e){var t;null!==(t=this.l)&&void 0!==t||(this.l=[]),this.l.push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach(((t,i)=>{const o=this._$Eh(i,t);void 0!==o&&(this._$Eu.set(o,i),e.push(o))})),e}static createProperty(e,t=l$2){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const i="symbol"==typeof e?Symbol():"__"+e,o=this.getPropertyDescriptor(e,i,t);void 0!==o&&Object.defineProperty(this.prototype,e,o)}}static getPropertyDescriptor(e,t,i){return{get(){return this[t]},set(o){const s=this[e];this[t]=o,this.requestUpdate(e,s,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||l$2}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),this.elementProperties=new Map(e.elementProperties),this._$Eu=new Map,this.hasOwnProperty("properties")){const e=this.properties,t=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(const i of t)this.createProperty(i,e[i])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const i=new Set(e.flat(1/0).reverse());for(const e of i)t.unshift(S$1(e))}else void 0!==e&&t.push(S$1(e));return t}static _$Eh(e,t){const i=t.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof e?e.toLowerCase():void 0}o(){var e;this._$Ep=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$Em(),this.requestUpdate(),null===(e=this.constructor.l)||void 0===e||e.forEach((e=>e(this)))}addController(e){var t,i;(null!==(t=this._$Eg)&&void 0!==t?t:this._$Eg=[]).push(e),void 0!==this.renderRoot&&this.isConnected&&(null===(i=e.hostConnected)||void 0===i||i.call(e))}removeController(e){var t;null===(t=this._$Eg)||void 0===t||t.splice(this._$Eg.indexOf(e)>>>0,1)}_$Em(){this.constructor.elementProperties.forEach(((e,t)=>{this.hasOwnProperty(t)&&(this._$Et.set(t,this[t]),delete this[t])}))}createRenderRoot(){var e;const t=null!==(e=this.shadowRoot)&&void 0!==e?e:this.attachShadow(this.constructor.shadowRootOptions);return i$2(t,this.constructor.elementStyles),t}connectedCallback(){var e;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(e=this._$Eg)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostConnected)||void 0===t?void 0:t.call(e)}))}enableUpdating(e){}disconnectedCallback(){var e;null===(e=this._$Eg)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostDisconnected)||void 0===t?void 0:t.call(e)}))}attributeChangedCallback(e,t,i){this._$AK(e,i)}_$ES(e,t,i=l$2){var o,s;const n=this.constructor._$Eh(e,i);if(void 0!==n&&!0===i.reflect){const a=(null!==(s=null===(o=i.converter)||void 0===o?void 0:o.toAttribute)&&void 0!==s?s:o$2.toAttribute)(t,i.type);this._$Ei=e,null==a?this.removeAttribute(n):this.setAttribute(n,a),this._$Ei=null}}_$AK(e,t){var i,o,s;const n=this.constructor,a=n._$Eu.get(e);if(void 0!==a&&this._$Ei!==a){const e=n.getPropertyOptions(a),r=e.converter,l=null!==(s=null!==(o=null===(i=r)||void 0===i?void 0:i.fromAttribute)&&void 0!==o?o:"function"==typeof r?r:null)&&void 0!==s?s:o$2.fromAttribute;this._$Ei=a,this[a]=l(t,e.type),this._$Ei=null}}requestUpdate(e,t,i){let o=!0;void 0!==e&&(((i=i||this.constructor.getPropertyOptions(e)).hasChanged||n$4)(this[e],t)?(this._$AL.has(e)||this._$AL.set(e,t),!0===i.reflect&&this._$Ei!==e&&(void 0===this._$E_&&(this._$E_=new Map),this._$E_.set(e,i))):o=!1),!this.isUpdatePending&&o&&(this._$Ep=this._$EC())}async _$EC(){this.isUpdatePending=!0;try{await this._$Ep}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Et&&(this._$Et.forEach(((e,t)=>this[t]=e)),this._$Et=void 0);let t=!1;const i=this._$AL;try{t=this.shouldUpdate(i),t?(this.willUpdate(i),null===(e=this._$Eg)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostUpdate)||void 0===t?void 0:t.call(e)})),this.update(i)):this._$EU()}catch(e){throw t=!1,this._$EU(),e}t&&this._$AE(i)}willUpdate(e){}_$AE(e){var t;null===(t=this._$Eg)||void 0===t||t.forEach((e=>{var t;return null===(t=e.hostUpdated)||void 0===t?void 0:t.call(e)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Ep}shouldUpdate(e){return!0}update(e){void 0!==this._$E_&&(this._$E_.forEach(((e,t)=>this._$ES(t,this[t],e))),this._$E_=void 0),this._$EU()}updated(e){}firstUpdated(e){}}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var t$1;a$1.finalized=!0,a$1.elementProperties=new Map,a$1.elementStyles=[],a$1.shadowRootOptions={mode:"open"},null==h$1||h$1({ReactiveElement:a$1}),(null!==(s$2=globalThis.reactiveElementVersions)&&void 0!==s$2?s$2:globalThis.reactiveElementVersions=[]).push("1.1.2");const i$1=globalThis.trustedTypes,s$1=i$1?i$1.createPolicy("lit-html",{createHTML:e=>e}):void 0,e$1=`lit$${(Math.random()+"").slice(9)}$`,o$1="?"+e$1,n$3=`<${o$1}>`,l$1=document,h=(e="")=>l$1.createComment(e),r=e=>null===e||"object"!=typeof e&&"function"!=typeof e,d=Array.isArray,u=e=>{var t;return d(e)||"function"==typeof(null===(t=e)||void 0===t?void 0:t[Symbol.iterator])},c=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,v=/-->/g,a=/>/g,f=/>|[ 	\n\r](?:([^\s"'>=/]+)([ 	\n\r]*=[ 	\n\r]*(?:[^ 	\n\r"'`<>=]|("|')|))|$)/g,_=/'/g,m=/"/g,g=/^(?:script|style|textarea)$/i,p=e=>(t,...i)=>({_$litType$:e,strings:t,values:i}),$=p(1),b=Symbol.for("lit-noChange"),w=Symbol.for("lit-nothing"),T=new WeakMap,x=(e,t,i)=>{var o,s;const n=null!==(o=null==i?void 0:i.renderBefore)&&void 0!==o?o:t;let a=n._$litPart$;if(void 0===a){const e=null!==(s=null==i?void 0:i.renderBefore)&&void 0!==s?s:null;n._$litPart$=a=new N(t.insertBefore(h(),e),e,void 0,null!=i?i:{})}return a._$AI(e),a},A=l$1.createTreeWalker(l$1,129,null,!1),C=(e,t)=>{const i=e.length-1,o=[];let s,n=2===t?"<svg>":"",r=c;for(let t=0;t<i;t++){const i=e[t];let l,d,h=-1,p=0;for(;p<i.length&&(r.lastIndex=p,d=r.exec(i),null!==d);)p=r.lastIndex,r===c?"!--"===d[1]?r=v:void 0!==d[1]?r=a:void 0!==d[2]?(g.test(d[2])&&(s=RegExp("</"+d[2],"g")),r=f):void 0!==d[3]&&(r=f):r===f?">"===d[0]?(r=null!=s?s:c,h=-1):void 0===d[1]?h=-2:(h=r.lastIndex-d[2].length,l=d[1],r=void 0===d[3]?f:'"'===d[3]?m:_):r===m||r===_?r=f:r===v||r===a?r=c:(r=f,s=void 0);const u=r===f&&e[t+1].startsWith("/>")?" ":"";n+=r===c?i+n$3:h>=0?(o.push(l),i.slice(0,h)+"$lit$"+i.slice(h)+e$1+u):i+e$1+(-2===h?(o.push(void 0),t):u)}const l=n+(e[i]||"<?>")+(2===t?"</svg>":"");if(!Array.isArray(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return[void 0!==s$1?s$1.createHTML(l):l,o]};class E{constructor({strings:e,_$litType$:t},i){let o;this.parts=[];let s=0,n=0;const a=e.length-1,r=this.parts,[l,d]=C(e,t);if(this.el=E.createElement(l,i),A.currentNode=this.el.content,2===t){const e=this.el.content,t=e.firstChild;t.remove(),e.append(...t.childNodes)}for(;null!==(o=A.nextNode())&&r.length<a;){if(1===o.nodeType){if(o.hasAttributes()){const e=[];for(const t of o.getAttributeNames())if(t.endsWith("$lit$")||t.startsWith(e$1)){const i=d[n++];if(e.push(t),void 0!==i){const e=o.getAttribute(i.toLowerCase()+"$lit$").split(e$1),t=/([.?@])?(.*)/.exec(i);r.push({type:1,index:s,name:t[2],strings:e,ctor:"."===t[1]?M:"?"===t[1]?H:"@"===t[1]?I:S})}else r.push({type:6,index:s})}for(const t of e)o.removeAttribute(t)}if(g.test(o.tagName)){const e=o.textContent.split(e$1),t=e.length-1;if(t>0){o.textContent=i$1?i$1.emptyScript:"";for(let i=0;i<t;i++)o.append(e[i],h()),A.nextNode(),r.push({type:2,index:++s});o.append(e[t],h())}}}else if(8===o.nodeType)if(o.data===o$1)r.push({type:2,index:s});else{let e=-1;for(;-1!==(e=o.data.indexOf(e$1,e+1));)r.push({type:7,index:s}),e+=e$1.length-1}s++}}static createElement(e,t){const i=l$1.createElement("template");return i.innerHTML=e,i}}function P(e,t,i=e,o){var s,n,a,l;if(t===b)return t;let d=void 0!==o?null===(s=i._$Cl)||void 0===s?void 0:s[o]:i._$Cu;const h=r(t)?void 0:t._$litDirective$;return(null==d?void 0:d.constructor)!==h&&(null===(n=null==d?void 0:d._$AO)||void 0===n||n.call(d,!1),void 0===h?d=void 0:(d=new h(e),d._$AT(e,i,o)),void 0!==o?(null!==(a=(l=i)._$Cl)&&void 0!==a?a:l._$Cl=[])[o]=d:i._$Cu=d),void 0!==d&&(t=P(e,d._$AS(e,t.values),d,o)),t}class V{constructor(e,t){this.v=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}p(e){var t;const{el:{content:i},parts:o}=this._$AD,s=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:l$1).importNode(i,!0);A.currentNode=s;let n=A.nextNode(),a=0,r=0,l=o[0];for(;void 0!==l;){if(a===l.index){let t;2===l.type?t=new N(n,n.nextSibling,this,e):1===l.type?t=new l.ctor(n,l.name,l.strings,this,e):6===l.type&&(t=new L(n,this,e)),this.v.push(t),l=o[++r]}a!==(null==l?void 0:l.index)&&(n=A.nextNode(),a++)}return s}m(e){let t=0;for(const i of this.v)void 0!==i&&(void 0!==i.strings?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}}class N{constructor(e,t,i,o){var s;this.type=2,this._$AH=w,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=o,this._$Cg=null===(s=null==o?void 0:o.isConnected)||void 0===s||s}get _$AU(){var e,t;return null!==(t=null===(e=this._$AM)||void 0===e?void 0:e._$AU)&&void 0!==t?t:this._$Cg}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=P(this,e,t),r(e)?e===w||null==e||""===e?(this._$AH!==w&&this._$AR(),this._$AH=w):e!==this._$AH&&e!==b&&this.$(e):void 0!==e._$litType$?this.T(e):void 0!==e.nodeType?this.S(e):u(e)?this.A(e):this.$(e)}M(e,t=this._$AB){return this._$AA.parentNode.insertBefore(e,t)}S(e){this._$AH!==e&&(this._$AR(),this._$AH=this.M(e))}$(e){this._$AH!==w&&r(this._$AH)?this._$AA.nextSibling.data=e:this.S(l$1.createTextNode(e)),this._$AH=e}T(e){var t;const{values:i,_$litType$:o}=e,s="number"==typeof o?this._$AC(e):(void 0===o.el&&(o.el=E.createElement(o.h,this.options)),o);if((null===(t=this._$AH)||void 0===t?void 0:t._$AD)===s)this._$AH.m(i);else{const e=new V(s,this),t=e.p(this.options);e.m(i),this.S(t),this._$AH=e}}_$AC(e){let t=T.get(e.strings);return void 0===t&&T.set(e.strings,t=new E(e)),t}A(e){d(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let i,o=0;for(const s of e)o===t.length?t.push(i=new N(this.M(h()),this.M(h()),this,this.options)):i=t[o],i._$AI(s),o++;o<t.length&&(this._$AR(i&&i._$AB.nextSibling,o),t.length=o)}_$AR(e=this._$AA.nextSibling,t){var i;for(null===(i=this._$AP)||void 0===i||i.call(this,!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){var t;void 0===this._$AM&&(this._$Cg=e,null===(t=this._$AP)||void 0===t||t.call(this,e))}}class S{constructor(e,t,i,o,s){this.type=1,this._$AH=w,this._$AN=void 0,this.element=e,this.name=t,this._$AM=o,this.options=s,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=w}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,t=this,i,o){const s=this.strings;let n=!1;if(void 0===s)e=P(this,e,t,0),n=!r(e)||e!==this._$AH&&e!==b,n&&(this._$AH=e);else{const o=e;let a,l;for(e=s[0],a=0;a<s.length-1;a++)l=P(this,o[i+a],t,a),l===b&&(l=this._$AH[a]),n||(n=!r(l)||l!==this._$AH[a]),l===w?e=w:e!==w&&(e+=(null!=l?l:"")+s[a+1]),this._$AH[a]=l}n&&!o&&this.k(e)}k(e){e===w?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=e?e:"")}}class M extends S{constructor(){super(...arguments),this.type=3}k(e){this.element[this.name]=e===w?void 0:e}}const k=i$1?i$1.emptyScript:"";class H extends S{constructor(){super(...arguments),this.type=4}k(e){e&&e!==w?this.element.setAttribute(this.name,k):this.element.removeAttribute(this.name)}}class I extends S{constructor(e,t,i,o,s){super(e,t,i,o,s),this.type=5}_$AI(e,t=this){var i;if((e=null!==(i=P(this,e,t,0))&&void 0!==i?i:w)===b)return;const o=this._$AH,s=e===w&&o!==w||e.capture!==o.capture||e.once!==o.once||e.passive!==o.passive,n=e!==w&&(o===w||s);s&&this.element.removeEventListener(this.name,this,o),n&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,i;"function"==typeof this._$AH?this._$AH.call(null!==(i=null===(t=this.options)||void 0===t?void 0:t.host)&&void 0!==i?i:this.element,e):this._$AH.handleEvent(e)}}class L{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){P(this,e)}}const z=window.litHtmlPolyfillSupport;
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var l,o;null==z||z(E,N),(null!==(t$1=globalThis.litHtmlVersions)&&void 0!==t$1?t$1:globalThis.litHtmlVersions=[]).push("2.1.1");class s extends a$1{constructor(){super(...arguments),this.renderOptions={host:this},this._$Dt=void 0}createRenderRoot(){var e,t;const i=super.createRenderRoot();return null!==(e=(t=this.renderOptions).renderBefore)&&void 0!==e||(t.renderBefore=i.firstChild),i}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Dt=x(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),null===(e=this._$Dt)||void 0===e||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this._$Dt)||void 0===e||e.setConnected(!1)}render(){return b}}s.finalized=!0,s._$litElement$=!0,null===(l=globalThis.litElementHydrateSupport)||void 0===l||l.call(globalThis,{LitElement:s});const n$2=globalThis.litElementPolyfillSupport;null==n$2||n$2({LitElement:s}),(null!==(o=globalThis.litElementVersions)&&void 0!==o?o:globalThis.litElementVersions=[]).push("3.1.1");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const n$1=e=>t=>"function"==typeof t?((e,t)=>(window.customElements.define(e,t),t))(e,t):((e,t)=>{const{kind:i,elements:o}=t;return{kind:i,elements:o,finisher(t){window.customElements.define(e,t)}}})(e,t)
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */,i=(e,t)=>"method"===t.kind&&t.descriptor&&!("value"in t.descriptor)?{...t,finisher(i){i.createProperty(t.key,e)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:t.key,initializer(){"function"==typeof t.initializer&&(this[t.key]=t.initializer.call(this))},finisher(i){i.createProperty(t.key,e)}};function e(e){return(t,o)=>void 0!==o?((e,t,i)=>{t.constructor.createProperty(i,e)})(e,t,o):i(e,t)
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */}function t(t){return e({...t,state:!0})}
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var n;null===(n=window.HTMLSlotElement)||void 0===n||n.prototype.assignedElements;const acceptedTags=["circle","ellipse","rect","polyline","line","text","path"],highlightStyle={stroke:"rgba(255,0,0,.4)",lineDash:[12],strokeWidth:"5"},textPlaceHolder="Input text...",defaultSVGParams={strokeWidth:"1",stroke:"rgba(0,0,0,1)",fill:"rgba(0,0,0,0)",lineDash:[0],text:"Input text..."};var Tools_List,SVGParamFieldID;!function(e){e.DRAW="draw-tool",e.LINE="line-tool",e.RECT="rect-tool",e.ELLIPSE="ellipse-tool",e.SELECT="select-tool",e.TEXT="text-tool",e.MOVE="move-tool",e.DELETE="delete-tool",e.UNSELECT="unselect-tool"}(Tools_List||(Tools_List={})),function(e){e.TEXT_FONT_FAMILY="text-font-family-input",e.TEXT_FONT_SIZE="text-font-size-input",e.TEXT="text-input",e.STROKE_WIDTH="stroke-width-input",e.STROKE_COLOR="stroke-color-input",e.STROKE_OPACITY="stroke-opacity-input",e.FILL_COLOR="fill-color-input",e.FILL_OPACITY="fill-opacity-input",e.LINE_CAP="line-cap-input",e.LINE_DASH="line-dash-input"}(SVGParamFieldID||(SVGParamFieldID={}));const decimalNumberRegExp=new RegExp(/(-?\d*\.?\d+)/),decimalNumber=decimalNumberRegExp.source,separatorRegExp=new RegExp(/((\s?,\s?)|\s)/);separatorRegExp.source;const pathCommandsRegExp=new RegExp(`${decimalNumber}|[a-zA-Z]`,"g"),hexColorCodeRegExp=new RegExp(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i),getUniqueXandYCoordinatesFromBoundaries=e=>{const t=[...new Map(e)].reduce(((e,t)=>[[...e[0],t[0]],[...e[1],t[1]]]),[[],[]]);return[[...new Set(t[0])],[...new Set(t[1])]]},parseToFixed2HexString=e=>{let t=parseInt(e[0]).toString(16);return t.length<2&&(t="0".concat(t)),t},hexToRGBA=(e,t="1")=>{var i;const[,o,s,n]=null!==(i=hexColorCodeRegExp.exec(e))&&void 0!==i?i:["#000000","00","00","00"],a=[parseInt(o,16),parseInt(s,16),parseInt(n,16)];return"rgba(".concat(a.join(","),",",t,")")},normalizeColorCode=e=>{var t,i;if(!e)return{colorCode:"#000000",opacity:"0"};if("#"!==e.charAt(0)){const o=new RegExp(/\d*\.?\d+/g),s=[...e.matchAll(o)];if(4===s.length){const e=null!==(i=null===(t=s.pop())||void 0===t?void 0:t[0])&&void 0!==i?i:"0",o=s.map(parseToFixed2HexString);return{colorCode:"#".concat(o.join("")),opacity:e}}{const e=s.map(parseToFixed2HexString);return{colorCode:"#".concat(e.join("")),opacity:"1"}}}if(4===e.length){const t=e.substring(1);return{colorCode:"#".concat(t[0],t[0],t[1],t[1],t[2],t[2]),opacity:"1"}}return{colorCode:e,opacity:"1"}},relativeCoordinatesCommands=["a","c","m","s","q","t","l","z"],absoluteCoordinatesCommands=["A","C","L","M","Q","S","T","Z"],relativeSingleDirectionCommands=["h","v"],absoluteSingleDirectionCommands=["H","V"],relativeCommands=[...relativeCoordinatesCommands,relativeSingleDirectionCommands],singleDirectionCommands=[...relativeSingleDirectionCommands,...absoluteSingleDirectionCommands],pathCommandValues=[...relativeCoordinatesCommands,...absoluteCoordinatesCommands,...singleDirectionCommands],updateNextSiblingValue=e=>{var t,i;(null===(t=e.target)||void 0===t?void 0:t.nextElementSibling)&&(e.target.nextElementSibling.value=null===(i=e.currentTarget)||void 0===i?void 0:i.value)},updatePreviousSiblingValue=e=>{var t,i;(null===(t=e.target)||void 0===t?void 0:t.previousElementSibling)&&(e.target.previousElementSibling.value=null===(i=e.currentTarget)||void 0===i?void 0:i.value)},inputFieldGetterGenerator=e=>t=>null==e?void 0:e.querySelector("#"+t),updateStyleInputFields=(e,t)=>{var i,o,s,n,a,r,l,d,h;const c=(_=null===(i=e.shadowRoot)||void 0===i?void 0:i.getElementById("footer-input"),e=>null==_?void 0:_.querySelector("#"+e));var _;const p={colorCode:"#000000",opacity:"1"},u=t.stroke?normalizeColorCode(t.stroke):p,v=t.fill?normalizeColorCode(t.fill):p,f=c(SVGParamFieldID.FILL_COLOR),m=c(SVGParamFieldID.FILL_OPACITY),S=c(SVGParamFieldID.LINE_CAP),g=c(SVGParamFieldID.LINE_DASH),w=c(SVGParamFieldID.STROKE_COLOR),P=c(SVGParamFieldID.STROKE_OPACITY),E=c(SVGParamFieldID.STROKE_WIDTH),y=c(SVGParamFieldID.TEXT_FONT_FAMILY),C=c(SVGParamFieldID.TEXT_FONT_SIZE),F=c(SVGParamFieldID.TEXT);f&&(f.value=v.colorCode),m&&(m.value=v.opacity,m.dispatchEvent(new Event("change"))),S&&(S.value=null!==(o=t.lineCap)&&void 0!==o?o:"butt"),g&&(g.value=null!==(n=null===(s=t.lineDash)||void 0===s?void 0:s.join(","))&&void 0!==n?n:"0"),w&&(w.value=u.colorCode),P&&(P.value=u.opacity,P.dispatchEvent(new Event("change"))),E&&(E.value=null!==(a=t.strokeWidth)&&void 0!==a?a:"0"),y&&(y.value=null!==(r=t.fontFamily)&&void 0!==r?r:"Arial"),C&&(C.value=null!==(d=null===(l=t.fontSize)||void 0===l?void 0:l.toString())&&void 0!==d?d:"18"),F&&(F.value=null!==(h=t.text)&&void 0!==h?h:"Input text...")},getToolButton=(e,t)=>{var i,o,s;const n=null===(i=e.shadowRoot)||void 0===i?void 0:i.getElementById("tool-box"),a=null===(o=null==n?void 0:n.shadowRoot)||void 0===o?void 0:o.getElementById("tool-box-button-"+t);return null===(s=null==a?void 0:a.shadowRoot)||void 0===s?void 0:s.getElementById(t)},setIsButtonActive=(e,t,i=!0)=>{const o=getToolButton(e,t);null==o||o.setAttribute("isactive",`${i}`)},setIsButtonDisabled=(e,t,i=!0)=>{const o=getToolButton(e,t);i?null==o||o.setAttribute("disabled",""):null==o||o.removeAttribute("disabled")};let nanoid=(e=21)=>{let t="",i=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let o=63&i[e];t+=o<36?o.toString(36):o<62?(o-26).toString(36).toUpperCase():o<63?"_":"-"}return t};const getCanvasRectangleValuesFromPoints=(e,t)=>({startingCorner:e,width:t[0]-e[0],height:t[1]-e[1]}),calculateDistanceBetweenPoints=(e,t)=>{const i=e[0]-t[0],o=e[1]-t[1],s=Math.pow(i,2)+Math.pow(o,2);return Math.sqrt(s)},partitionCoordinates=e=>e.reduce(((e,t)=>[[...e[0],t[0]],[...e[1],t[1]]]),[[],[]]),betweenHelper=e=>(t,i)=>e[0]>=t[0]&&e[1]>=t[1]&&e[0]<=i[0]&&e[1]<=i[1],isBetweenTwoCoordinates=(e,t)=>i=>{const o=betweenHelper(i);if(e[0]<=t[0]&&e[1]<=t[1])return o(e,t);o(e,e)},isPointInsideAnotherShape=e=>t=>isShapeInsideAnotherShape(t)({boundaries:[e,e,e,e]}),isShapeInsideAnotherShape=e=>t=>{var i;if(!e)return!1;const{boundaries:o}=e;if(o){const[e,a]=o.reduce(((e,t)=>[[...e[0],t[0]],[...e[1],t[1]]]),[[],[]]),r=[Math.min(...e),Math.min(...a)],l=[Math.max(...e),Math.max(...a)];return null===(i=t.boundaries)||void 0===i?void 0:i.every((s=r,n=l,e=>{const t=betweenHelper(e);if(s[0]<=n[0]&&s[1]<=n[1])return t(s,n);t(s,s)}))}var s,n},getTextBoundaries=(e,t,i)=>{const o=parseInt(e[0].toString());parseInt(e[0].toString());const s=[o,e[1]+i/4],n=[o,e[1]-i],a=[e[0]+t,e[1]],r=[e[0]+t,e[1]-i];return console.debug(s,n,a,r),[s,n,a,r]},splitCoordinates=(e,t)=>[[...e[0],t[0]],[...e[1],t[1]]],splitAllCoordinates=e=>e.reduce(splitCoordinates,[[],[]]),getMinMaxValuesOfSplitCoordinates=(e,t)=>({xMin:Math.min(...e),yMin:Math.min(...t),xMax:Math.max(...e),yMax:Math.max(...t)}),getMinMaxValuesOfCoordinates=e=>{const[t,i]=splitAllCoordinates(e);return getMinMaxValuesOfSplitCoordinates(t,i)},getBoundaryFromCoordinates=e=>{const{xMin:t,xMax:i,yMin:o,yMax:s}=getMinMaxValuesOfCoordinates(e);return[[t,o],[i,o],[t,s],[i,s]]},sumOfCoordinates=e=>t=>[e[0]+t[0],e[1]+t[1]],rectangleParamsFromBoundaries=e=>{const[t,i]=Array.from(new Set(splitAllCoordinates(e))),{xMin:o,yMin:s,xMax:n,yMax:a}=getMinMaxValuesOfSplitCoordinates(t,i);return{startingCorner:[o,s],width:n-o,height:a-s}},measureText=(e,t,i,o)=>{var s,n;const a=document.createElement("canvas");document.body.appendChild(a);let r=null!==(n=null!==(s=null==i?void 0:i.getContext("2d"))&&void 0!==s?s:o)&&void 0!==n?n:a.getContext("2d");if(!r)return;r.font=`${t.fontSize}px ${t.fontFamily}`,t.stroke&&(r.strokeStyle=t.stroke),t.lineDash&&r.setLineDash(t.lineDash),t.lineCap&&(r.lineCap=t.lineCap);const l=r.measureText(e),d=l.width,h=l.fontBoundingBoxAscent+l.fontBoundingBoxDescent;return document.body.removeChild(a),{width:d,height:h}},isEllipse=e=>void 0!==e.toSVGEllipseParams,isRectangle=e=>void 0!==e.toSvgRectParams,isLine=e=>void 0!==e.toSVGLineParams,isPath=e=>void 0!==e.toSVGPathParams,isText=e=>void 0!==e.toSVGTextParams,isShapeType=e=>!!e&&void 0!==e.getDeconstructedShapeData,typeOfShape=e=>isRectangle(e)?"Rectangle":isEllipse(e)?"Ellipse":isLine(e)?"Line":isPath(e)?"Path":isText(e)?"TextShape":"Freehand",isMoveTool=e=>!!e&&void 0!==e.toolName&&e.toolName===Tools_List.MOVE;var _a,_Shape_counter,_Shape_fill,_Shape_id,_Shape_stroke,_Shape_strokeWidth,_Shape_lineCap,_Shape_lineDash,_Shape_fontSize,_Shape_fontFamily;class Shape{constructor(e=[[-1,-1],[-1,-1],[-1,-1],[-1,-1]],t={},i=!0,o=!1){var s,n,a,r,l,d,h,c,_;_Shape_fill.set(this,void 0),_Shape_id.set(this,void 0),_Shape_stroke.set(this,void 0),_Shape_strokeWidth.set(this,void 0),_Shape_lineCap.set(this,void 0),_Shape_lineDash.set(this,void 0),_Shape_fontSize.set(this,void 0),_Shape_fontFamily.set(this,void 0),this.isLocked=!1,this.text="Input text...",this.calculationCenter=[-1,-1],this.index=0,this.moveTransformMatrix=(e,t)=>{const{a:i,b:o,c:s,d:n,e:a,f:r}=this.transformMatrix||new DOMMatrix;this.transformMatrix=new DOMMatrix([i,o,s,n,a+e,r+t])},this.updateSVGParam=(e,t)=>{const i=this.getSvgParams();i[e]=t,this.updateSVGParams(i)},this.updateSVGParams=e=>{var t;if(__classPrivateFieldSet(this,_Shape_fill,e.fill,"f"),__classPrivateFieldSet(this,_Shape_stroke,e.stroke,"f"),__classPrivateFieldSet(this,_Shape_strokeWidth,e.strokeWidth,"f"),__classPrivateFieldSet(this,_Shape_lineCap,e.lineCap,"f"),__classPrivateFieldSet(this,_Shape_lineDash,e.lineDash,"f"),__classPrivateFieldSet(this,_Shape_fontFamily,e.fontFamily,"f"),__classPrivateFieldSet(this,_Shape_fontSize,e.fontSize,"f"),isText(this)){this.text=null!==(t=e.text)&&void 0!==t?t:this.text;const i=measureText(this.text,this.getSvgParams());i&&(this.boundaries=getTextBoundaries(this.getCenter(),null==i?void 0:i.width,null==i?void 0:i.height))}},this.replaceID=e=>(__classPrivateFieldSet(this,_Shape_id,e,"f"),this),this.moveBoundaries=e=>{var t;const[i,o]=e;this.boundaries=null===(t=this.boundaries)||void 0===t?void 0:t.map((e=>[e[0]+i,e[1]+o]))},this.getSvgParams=()=>({fill:__classPrivateFieldGet(this,_Shape_fill,"f"),stroke:__classPrivateFieldGet(this,_Shape_stroke,"f"),strokeWidth:__classPrivateFieldGet(this,_Shape_strokeWidth,"f"),transformMatrix:this.transformMatrix,lineCap:__classPrivateFieldGet(this,_Shape_lineCap,"f"),lineDash:__classPrivateFieldGet(this,_Shape_lineDash,"f"),fontSize:__classPrivateFieldGet(this,_Shape_fontSize,"f"),fontFamily:__classPrivateFieldGet(this,_Shape_fontFamily,"f"),text:this.text}),this.getId=()=>__classPrivateFieldGet(this,_Shape_id,"f"),this.getCenter=()=>this.calculationCenter,this.moveTo=e=>{const[t,i]=[e[0]-this.calculationCenter[0],e[1]-this.calculationCenter[1]];this.calculationCenter=e,this.moveBoundaries([t,i])},this.toString=()=>{throw new Error("not implemented")},this.getDeconstructedShapeData=()=>{throw new Error("not implemented")},i&&__classPrivateFieldSet(c=Shape,_a,(_=__classPrivateFieldGet(c,_a,"f",_Shape_counter),++_),"f",_Shape_counter),__classPrivateFieldSet(this,_Shape_id,nanoid(),"f"),__classPrivateFieldSet(this,_Shape_fill,null!==(s=t.fill)&&void 0!==s?s:"rgba(0,0,0,0)","f"),__classPrivateFieldSet(this,_Shape_stroke,null!==(n=t.stroke)&&void 0!==n?n:"rgba(0,0,0,1)","f"),__classPrivateFieldSet(this,_Shape_strokeWidth,null!==(a=t.strokeWidth)&&void 0!==a?a:"1","f"),__classPrivateFieldSet(this,_Shape_lineDash,null!==(r=t.lineDash)&&void 0!==r?r:[0],"f"),__classPrivateFieldSet(this,_Shape_fontSize,null!==(l=t.fontSize)&&void 0!==l?l:18,"f"),__classPrivateFieldSet(this,_Shape_fontFamily,null!==(d=t.fontFamily)&&void 0!==d?d:"Arial","f"),this.text=null!==(h=t.text)&&void 0!==h?h:this.text,this.transformMatrix=t.transformMatrix,this.boundaries=e,this.isLocked=o,this.index=__classPrivateFieldGet(Shape,_a,"f",_Shape_counter)}}_a=Shape,_Shape_fill=new WeakMap,_Shape_id=new WeakMap,_Shape_stroke=new WeakMap,_Shape_strokeWidth=new WeakMap,_Shape_lineCap=new WeakMap,_Shape_lineDash=new WeakMap,_Shape_fontSize=new WeakMap,_Shape_fontFamily=new WeakMap,_Shape_counter={value:0};const getCircleBoundaries=(e,t,i)=>[[e[0]-t,e[1]+i],[e[0]+t,e[1]+i],[e[0]-t,e[1]-i],[e[0]+t,e[1]-i]];class Ellipse extends Shape{constructor(e,t,i,o,s,n=!1){super(getCircleBoundaries(e,t,i),o,s,n),this.getCenter=()=>this.calculationCenter,this.toSVGEllipseParams=()=>Object.assign({cx:this.calculationCenter[0].toString(),cy:this.calculationCenter[1].toString(),rx:this.radiusX.toString(),ry:this.radiusY.toString()},this.getSvgParams()),this.getDeconstructedShapeData=()=>({type:"Ellipse",id:this.getId(),center:this.calculationCenter,radiusX:this.radiusX,radiusY:this.radiusY,isLocked:this.isLocked,svgParams:this.getSvgParams()}),this.toString=()=>JSON.stringify({center:this.calculationCenter,radiusX:this.radiusX,radiusY:this.radiusY}),this.calculationCenter=e,this.radiusX=t,this.radiusY=i}}const getFreehandBoundaries=e=>{const[t,i]=getUniqueXandYCoordinatesFromBoundaries(e),o=Math.max(...t),s=Math.max(...i),n=Math.min(...t),a=Math.min(...i);return[[n,a],[n,s],[o,a],[o,s]]};var _Freehand_points,_Freehand_updateCenter;class Freehand extends Shape{constructor(e,t,i,o=!1){super(getFreehandBoundaries(e),t,i,o),_Freehand_points.set(this,void 0),_Freehand_updateCenter.set(this,(()=>{const e=this.boundaries.reduce(((e,t)=>[e[0]+t[0],e[1]+t[1]]),[0,0]);this.calculationCenter=[e[0]/4,e[1]/4]})),this.getCenter=()=>this.calculationCenter,this.moveTo=e=>{const t=e[0]-this.calculationCenter[0],i=e[1]-this.calculationCenter[1];__classPrivateFieldSet(this,_Freehand_points,__classPrivateFieldGet(this,_Freehand_points,"f").map((e=>[e[0]+t,e[1]+i])),"f"),__classPrivateFieldGet(this,_Freehand_updateCenter,"f").call(this),this.moveBoundaries([t,i])},this.getPoints=()=>__classPrivateFieldGet(this,_Freehand_points,"f"),this.toSVGFreehandParams=()=>Object.assign({points:this.toString()},this.getSvgParams()),this.getDeconstructedShapeData=()=>({id:this.getId(),type:"Freehand",points:__classPrivateFieldGet(this,_Freehand_points,"f"),isLocked:this.isLocked,svgParams:this.getSvgParams()}),this.toString=()=>__classPrivateFieldGet(this,_Freehand_points,"f").reduce(((e,t)=>e.concat(`${t[0]}`,",",`${t[1]}`," ")),"").trim(),__classPrivateFieldSet(this,_Freehand_points,e,"f"),__classPrivateFieldGet(this,_Freehand_updateCenter,"f").call(this)}}_Freehand_points=new WeakMap,_Freehand_updateCenter=new WeakMap;const getLineBoundaries=(e,t)=>{const i=e[0],o=t[0],s=e[1],n=t[1];return[[i,s],[i,n],[o,s],[o,n]]};class Line extends Shape{constructor(e,t,i,o,s=!1){super(getLineBoundaries(e,t),i,o,s),this.moveTo=e=>{const t=e[0]-this.calculationCenter[0],i=e[1]-this.calculationCenter[1];this.calculationCenter=e,this.points=this.points.map((e=>[e[0]+t,e[1]+i])),this.moveBoundaries([t,i])},this.getCenter=()=>this.calculationCenter,this.toSVGLineParams=()=>Object.assign({x1:this.points[0][0].toString(),y1:this.points[0][1].toString(),x2:this.points[1][0].toString(),y2:this.points[1][1].toString()},this.getSvgParams()),this.getDeconstructedShapeData=()=>({id:this.getId(),type:"Line",startPoint:this.points[0],endPoint:this.points[1],isLocked:this.isLocked,svgParams:this.getSvgParams()}),this.toString=()=>JSON.stringify({start:{x:this.points[0][0],y:this.points[0][1]},end:{x:this.points[1][0],y:this.points[1][1]}}),this.points=[e,t],this.calculationCenter=[(e[0]+t[0])/2,(e[1]+t[1])/2]}}const getPointsOfDrawPath=e=>e.reduce(((e,t)=>{if(!t.points)return e;if(Array.isArray(t.points)&&singleDirectionCommands.includes(t.command))switch(t.command){case"H":case"h":return[...e,[0,parseFloat(t.points[0])]];case"V":case"v":return[...e,[parseFloat(t.points[0]),0]]}return[...e,...t.points]}),[]),relativePathToAbsolutePath=(e,t)=>{let i=[0,0];return e.reduce(((e,o)=>{if(!Array.isArray(o.points))return[...e,{command:o.command.toUpperCase(),points:o.points}];if(relativeCommands.includes(o.command)){const t=o.points.reduce(((e,t,s)=>"c"===o.command?s%3==2?(i=[i[0]+1.05*t[0],i[1]+1.05*t[1]],[...e,i]):e:0===s?(i=[i[0]+t[0],i[1]+t[1]],[i]):(i=[i[0]+t[0],i[1]+t[1]],[...e,i])),[]);return[...e,{command:o.command.toUpperCase(),points:t}]}return[...e,{command:o.command,points:t?o.points.map(sumOfCoordinates(t)):o.points}]}),[])},getPathBoundaries=e=>{const t=relativePathToAbsolutePath(e),i=getPointsOfDrawPath(t);return getBoundaryFromCoordinates(i)};var _Path_rawDrawPath;class Path extends Shape{constructor(e,t,i,o=!1){if(super(void 0,t,i,o),_Path_rawDrawPath.set(this,void 0),this.getCenter=()=>this.calculationCenter,this.toSVGPathParams=()=>Object.assign({d:this.toString()},this.getSvgParams()),this.getDeconstructedShapeData=()=>({id:this.getId(),type:"Path",drawPath:__classPrivateFieldGet(this,_Path_rawDrawPath,"f"),isLocked:this.isLocked,svgParams:this.getSvgParams()}),this.moveTo=e=>{const[t,i]=[e[0]-this.calculationCenter[0],e[1]-this.calculationCenter[1]];this.moveTransformMatrix(t,i),this.calculationCenter=[this.calculationCenter[0]+t,this.calculationCenter[1]+i],this.boundaries=this.boundaries.map((e=>[e[0]+t,e[1]+i]))},this.toString=()=>{const e=this.drawPath.reduce(((e,t)=>{var i;return e.concat(" ",t.command," ",Array.isArray(t.points)?t.points.reduce(((e,t)=>e.concat([t[0].toString(),t[1].toString()].join()," ")),""):null!==(i=t.points)&&void 0!==i?i:""," ").trim()}),"");return e},__classPrivateFieldSet(this,_Path_rawDrawPath,e,"f"),this.drawPath=e.map((e=>(singleDirectionCommands.includes(e.command),{command:e.command,points:e.points}))),null==t?void 0:t.bBox){const{x:e,y:i,width:o,height:s}=t.bBox,n=[[e,i],[e,i+s],[e+o,i],[e+o,i+s]];this.boundaries=n.map((e=>{const t=new DOMPoint(e[0],e[1]).matrixTransform(this.transformMatrix);return[t.x,t.y]}))}else this.boundaries=getPathBoundaries(this.drawPath);const s=this.boundaries.reduce(((e,t)=>sumOfCoordinates(e)(t)),[0,0]);this.calculationCenter=[s[0]/4,s[1]/4]}}_Path_rawDrawPath=new WeakMap;const getRectangleBoundaries=(e,t,i)=>{const o=e[0],s=e[1],n=e[0]+t,a=e[1]+i;return[[o,a],[o,s],[n,a],[n,s]]};var _Rectangle_width,_Rectangle_height,_TextShape_height,_TextShape_width;class Rectangle extends Shape{constructor(e,t,i,o={},s,n=!1){super(getRectangleBoundaries(e,t,i),o,s,n),_Rectangle_width.set(this,0),_Rectangle_height.set(this,0),this.resize=e=>{__classPrivateFieldSet(this,_Rectangle_width,2*(e[0]-this.calculationCenter[0]),"f"),__classPrivateFieldSet(this,_Rectangle_height,2*(e[1]-this.calculationCenter[1]),"f")},this.moveTo=e=>{const t=e[0]-this.calculationCenter[0],i=e[1]-this.calculationCenter[1];this.calculationCenter=e,this.moveBoundaries([t,i])},this.getCenter=()=>this.calculationCenter,this.getWidth=()=>__classPrivateFieldGet(this,_Rectangle_width,"f"),this.getHeight=()=>__classPrivateFieldGet(this,_Rectangle_height,"f"),this.toSvgRectParams=()=>Object.assign({x:this.calculationCenter[0].toString(),y:this.calculationCenter[1].toString(),width:__classPrivateFieldGet(this,_Rectangle_width,"f").toString(),height:__classPrivateFieldGet(this,_Rectangle_height,"f").toString()},this.getSvgParams()),this.getDeconstructedShapeData=()=>({id:this.getId(),type:"Rectangle",startingCorner:this.calculationCenter,width:__classPrivateFieldGet(this,_Rectangle_width,"f"),height:__classPrivateFieldGet(this,_Rectangle_height,"f"),isLocked:this.isLocked,svgParams:this.getSvgParams()}),this.toString=()=>JSON.stringify(this.boundaries),this.calculationCenter=e,__classPrivateFieldSet(this,_Rectangle_width,t,"f"),__classPrivateFieldSet(this,_Rectangle_height,i,"f")}}_Rectangle_width=new WeakMap,_Rectangle_height=new WeakMap;class TextShape extends Shape{constructor(e,t,i,o,s,n=!1){super(getTextBoundaries(i,e,t),o,s,n),_TextShape_height.set(this,void 0),_TextShape_width.set(this,void 0),this.getText=()=>this.text,this.getHeight=()=>__classPrivateFieldGet(this,_TextShape_height,"f"),this.getWidth=()=>__classPrivateFieldGet(this,_TextShape_width,"f"),this.moveTo=e=>{const[t,i]=[e[0]-this.calculationCenter[0],e[1]-this.calculationCenter[1]];this.calculationCenter=e,this.moveBoundaries([t,i])},this.getCenter=()=>this.calculationCenter,this.getDeconstructedShapeData=()=>({id:this.getId(),type:"TextShape",width:__classPrivateFieldGet(this,_TextShape_width,"f"),height:__classPrivateFieldGet(this,_TextShape_height,"f"),position:this.calculationCenter,isLocked:this.isLocked,svgParams:this.getSvgParams()}),this.toSVGTextParams=()=>Object.assign({position:this.calculationCenter},this.getSvgParams()),__classPrivateFieldSet(this,_TextShape_width,e,"f"),__classPrivateFieldSet(this,_TextShape_height,t,"f"),this.calculationCenter=i}}_TextShape_height=new WeakMap,_TextShape_width=new WeakMap;const setSVGStyleParams=(e,t,i,o,s,n,a)=>{const{a:r,b:l,c:d,d:h,e:c,f:_}=a||{};s&&e.setAttribute("stroke",s),n&&e.setAttribute("stroke-width",n),o&&e.setAttribute("fill",o),t&&e.setAttribute("stroke-dasharray",t.join(" ")),i&&e.setAttribute("stroke-linecap",i),a&&e.setAttribute("transform",`matrix(${[r,l,d,h,c,_].join(",")})`)},setRectSVGParams=(e,t)=>{const{x:i,y:o,width:s,height:n,fill:a,stroke:r,strokeWidth:l,lineDash:d,lineCap:h}=t;e.setAttribute("x",i),e.setAttribute("y",o),e.setAttribute("width",s),e.setAttribute("height",n),setSVGStyleParams(e,d,h,a,r,l)},setEllipseSVGParams=(e,t)=>{const{cx:i,cy:o,rx:s,ry:n,fill:a,stroke:r,strokeWidth:l,lineDash:d,lineCap:h}=t;e.setAttribute("cx",i),e.setAttribute("cy",o),e.setAttribute("rx",s),e.setAttribute("ry",n),setSVGStyleParams(e,d,h,a,r,l)},setCircleSVGParams=(e,t)=>{const{cx:i,cy:o,rx:s,fill:n,stroke:a,strokeWidth:r,lineDash:l,lineCap:d}=t;e.setAttribute("cx",i),e.setAttribute("cy",o),e.setAttribute("r",s),setSVGStyleParams(e,l,d,n,a,r)},setLineSVGParams=(e,t)=>{const{x1:i,y1:o,x2:s,y2:n,stroke:a,strokeWidth:r,lineDash:l,lineCap:d}=t;e.setAttribute("x1",i),e.setAttribute("y1",o),e.setAttribute("x2",s),e.setAttribute("y2",n),setSVGStyleParams(e,l,d,void 0,a,r)},setFreehandSVGParams=(e,t)=>{const{points:i,stroke:o,strokeWidth:s,lineDash:n,lineCap:a}=t;e.setAttribute("points",i),setSVGStyleParams(e,n,a,void 0,o,s)},setPathSVGParams=(e,t)=>{const{d:i,fill:o,stroke:s,strokeWidth:n,transformMatrix:a,lineDash:r,lineCap:l}=t;e.setAttribute("d",i),setSVGStyleParams(e,r,l,o,s,n,a)},setTextSVGParams=(e,t)=>{const i=t.toSVGTextParams(),{position:o,lineDash:s,lineCap:n,fill:a,stroke:r,strokeWidth:l,transformMatrix:d=new DOMMatrix([1,0,0,1,0,0]),fontFamily:h,fontSize:c,text:_}=i;_&&(e.setAttribute("x",o[0].toString()),e.setAttribute("y",o[1].toString()),e.setAttribute("style","font-family:".concat(null!=h?h:"arial",";","font-size:",(null!=c?c:12).toString(),"px")),e.innerHTML=_,setSVGStyleParams(e,s,n,a,r,l,d))},shapeToSVGFuncGenerator=(e,t=null)=>i=>{switch(typeOfShape(i)){case"Rectangle":{const o=i,s=document.createElementNS(t,"rect");setRectSVGParams(s,o.toSvgRectParams()),null==e||e.appendChild(s);break}case"Ellipse":{const o=i;if(o.radiusX===o.radiusY){const i=document.createElementNS(t,"circle");setCircleSVGParams(i,o.toSVGEllipseParams()),null==e||e.appendChild(i)}else{const i=document.createElementNS(t,"ellipse");setEllipseSVGParams(i,o.toSVGEllipseParams()),null==e||e.appendChild(i)}break}case"Line":{const o=i,s=document.createElementNS(t,"line");setLineSVGParams(s,o.toSVGLineParams()),null==e||e.appendChild(s);break}case"Freehand":{const o=i,s=document.createElementNS(t,"polyline");setFreehandSVGParams(s,o.toSVGFreehandParams()),null==e||e.appendChild(s);break}case"Path":{const o=i,s=document.createElementNS(t,"path");setPathSVGParams(s,o.toSVGPathParams()),null==e||e.append(s);break}case"TextShape":{const o=i,s=document.createElementNS(t,"text");setTextSVGParams(s,o),null==e||e.append(s);break}}},convertMatchesToSVGDrawPath=e=>{const t=e[0].trim(),i=e.slice(1);if(singleDirectionCommands.includes(t))return{command:t,points:i.shift()};return{command:t,points:i.reduce(((e,t,o)=>{if(o%2==0)return e;const s=[parseFloat(i[o-1]),parseFloat(t)];return[...e,s]}),[])}},getPathCommands=e=>{const t=Array.from(e.matchAll(pathCommandsRegExp)).map((e=>e[0])),i=t.reduce(((e,t,i)=>pathCommandValues.includes(t)?[...e,i]:e),[]);return i.reduce(((e,o,s)=>s===i.length-1?[...e,t.slice(o)]:[...e,t.slice(o,i[s+1])]),[]).map(convertMatchesToSVGDrawPath)},generateSVGURLFromShapes=e=>{const t=new XMLSerializer,i="http://www.w3.org/2000/svg",o=document.createElementNS(i,"svg"),s=document.createElementNS(i,"g"),[n,a]=e.reduce(((e,t)=>{var i;return[[...e[0],...t.boundaries],[...e[1],parseInt(null!==(i=t.getSvgParams().strokeWidth)&&void 0!==i?i:"0")]]}),[[],[]]),r=getMinMaxValuesOfCoordinates(n),l=Math.max(...a),d=r.yMin-l,h=r.xMin-l;o.setAttribute("height",(r.yMax-d).toString()),o.setAttribute("width",(r.xMax-h).toString()),s.setAttribute("transform","translate("+-r.xMin+","+-r.yMin+")"),o.appendChild(s);const c=shapeToSVGFuncGenerator(s,i);e.forEach(c);let _=t.serializeToString(o);return _.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)||(_=_.replace(/^<svg/,'<svg xmlns="http://www.w3.org/2000/svg"')),_='<?xml version="1.0" standalone="no"?>\r\n'+_,"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(_)},getSVGParamsFromSVG=e=>{var t,i,o;const s=normalizeColorCode(e.getAttribute("fill")),n=normalizeColorCode(e.getAttribute("stroke")),a=hexToRGBA(s.colorCode,s.opacity),r=hexToRGBA(n.colorCode,n.opacity),l=null!==(t=e.getAttribute("stroke-width"))&&void 0!==t?t:"",d=null!==(i=e.getCTM())&&void 0!==i?i:void 0,h=e.style.fontSize,c=e.style.fontFamily,_=null===(o=e.getAttribute("stroke-dasharray"))||void 0===o?void 0:o.split(" ").map(parseInt),p=e.getAttribute("line-cap"),u="text"===e.tagName?e.innerHTML:"",v=e.getBBox();return{fill:a,stroke:r,strokeWidth:l,text:u,fontSize:h?parseInt(h):void 0,fontFamily:c,transformMatrix:d,lineDash:_,lineCap:p,bBox:v}},elementWrapper=e=>({getFloatAttribute:t=>{const i=e.getAttribute(t);return i?parseFloat(i):-1},getAttribute:e.getAttribute}),convertToShapeType=e=>{var t,i;const o=getSVGParamsFromSVG(e),s=elementWrapper(e);switch(e.tagName){case acceptedTags[0]:{const e=s.getFloatAttribute("cx"),t=s.getFloatAttribute("cy"),i=s.getFloatAttribute("r");return new Ellipse([e,t],i,i,o)}case acceptedTags[1]:{const e=s.getFloatAttribute("cx"),t=s.getFloatAttribute("cy"),i=s.getFloatAttribute("rx"),n=s.getFloatAttribute("ry");return new Ellipse([e,t],i,n,o)}case acceptedTags[2]:{const e=s.getFloatAttribute("x"),t=s.getFloatAttribute("y"),i=s.getFloatAttribute("width"),n=s.getFloatAttribute("height");return new Rectangle([e,t],i,n,o)}case acceptedTags[3]:{const e=(null!==(t=s.getAttribute("points"))&&void 0!==t?t:"").split(" ").map((e=>{const[t,i]=e.split(",");return[parseFloat(t),parseFloat(i)]}));return new Freehand(e,o)}case acceptedTags[4]:{const e=s.getFloatAttribute("x1"),t=s.getFloatAttribute("x2"),i=s.getFloatAttribute("y1"),n=s.getFloatAttribute("y2");return new Line([e,i],[t,n],o)}case acceptedTags[5]:{const t=s.getFloatAttribute("x"),i=s.getFloatAttribute("y"),{width:n,height:a}=e.getBBox();return new TextShape(n,a,[t,i],o)}default:{const e=null!==(i=s.getAttribute("d"))&&void 0!==i?i:"",t=getPathCommands(e);return new Path(t,o,!0)}}},convertSVGDocumentToShapes=e=>{const t=document.getElementById(e);return t?acceptedTags.map((e=>Array.from(t.getElementsByTagName(e)).map(convertToShapeType))).flat():[]},importSVG=e=>{if(e.firstChild){const t=document.createElementNS("http://www.w3.org/2000/svg","svg"),i="#imported-svg#";t.setAttribute("id",i),t.appendChild(e.firstChild);const o=document.body.appendChild(t),s=convertSVGDocumentToShapes(i);return document.body.removeChild(o),s}},Pen={draw:(e,t,i)=>{switch(typeOfShape(e)){case"Ellipse":Pen.drawEllipse(e,i,t);break;case"Rectangle":Pen.drawRectangle(e,i,t);break;case"Line":Pen.drawLine(e,i,t);break;case"Freehand":Pen.drawFreehand(e,i,t);break;case"Path":Pen.drawPath(e,i,t);break;case"TextShape":Pen.drawText(e,i,t)}},setStyles:(e,t,i)=>{const{fill:o,stroke:s,strokeWidth:n,transformMatrix:a,lineCap:r,lineDash:l}=t;if(a){const t=new Path2D;t.addPath(e,a),e=t}return l&&i.setLineDash(l),r&&(i.lineCap=r),s||o||n?(n&&(i.lineWidth=parseFloat(n)),o&&"none"!==o&&(i.fillStyle=o),s&&"null"!==s&&(i.strokeStyle=s),e):(i.stroke(e),i.fill(e),e)},drawPath:(e,t,i)=>{let o=new Path2D(e.toString());if(t){const s=Object.assign(Object.assign({},e.getSvgParams()),i);o=Pen.setStyles(o,s,t),s.stroke&&t.stroke(o),s.fill&&t.fill(o),t.closePath()}},drawText:(e,t,i)=>{var o,s;const n=e.toSVGTextParams(),{position:a}=n,r=__rest(n,["position"]),l=null!=i?i:r,{text:d,fontSize:h,fontFamily:c}=l,_=__rest(l,["text","fontSize","fontFamily"]);t&&d&&(_.stroke&&(t.strokeStyle=_.stroke),r.lineDash&&t.setLineDash(r.lineDash),r.lineCap&&(t.lineCap=r.lineCap),r.strokeWidth&&(t.lineWidth=parseInt(r.strokeWidth)),t.fillStyle=null!==(o=_.fill)&&void 0!==o?o:"#000000",t.font=(null!==(s=null==h?void 0:h.toString())&&void 0!==s?s:"12").concat("px ",(null!=c?c:"Arial").toLowerCase()),t.fillText(d,...a),t.strokeText(d,...a),null==t||t.closePath())},drawFreehand:(e,t,i)=>{let o=new Path2D;const s=e.getPoints(),n=s[0],a=s.slice(1),r=null!=i?i:e.getSvgParams();t&&(Pen.setStyles(o,r,t),o.moveTo(...n),a.forEach((e=>{o.lineTo(...e)})),null==t||t.stroke(o),null==t||t.closePath())},drawLine:(e,t,i)=>{let o=new Path2D;if(t){const s=null!=i?i:e.getSvgParams();Pen.setStyles(o,s,t);const{fill:n,stroke:a}=s;o.moveTo(...e.points[0]),o.lineTo(...e.points[1]),a&&t.stroke(o),n&&t.fill(o),t.closePath()}},drawRectangle:(e,t,i)=>{let o=new Path2D;const s=e.toSvgRectParams(),{x:n,y:a,width:r,height:l}=s,d=__rest(s,["x","y","width","height"]),h=[n,a,r,l].map(parseFloat);if(t){const e=null!=i?i:d;o=Pen.setStyles(o,e,t);const{fill:s,stroke:n}=e;o.rect(...h),n&&t.stroke(o),s&&t.fill(o),t.closePath()}},drawEllipse:(e,t,i)=>{const o=new Path2D,s=e.toSVGEllipseParams(),{cx:n,cy:a,rx:r,ry:l}=s,d=__rest(s,["cx","cy","rx","ry"]),h=[n,a,r,l].map(parseFloat);if(t){const e=null!=i?i:d;Pen.setStyles(o,e,t);const{fill:s,stroke:n}=e;o.ellipse(...h,0,0,2*Math.PI),n&&t.stroke(o),s&&t.fill(o),null==t||t.closePath}},clearCanvas:(e,t)=>{if(e){let i=t;i||(i=e.getContext("2d")),i&&i.clearRect(0,0,e.width,e.height)}}};Object.freeze(Pen);class Tool{constructor(e,t,i,o=[0,0],s,n={text:"Input text..."},a,r){var l,d;this.allShapes=[],this.shallWait=!1,this.isDrawing=!1,this.previousCoordinates=[0,0],this.currentCoordinates=[0,0],this.setSVGParam=(e,t)=>{this.drawPenConfig[e]=t},this.setSVGParams=e=>{this.drawPenConfig=e},this.resetPreview=()=>{this.previewLayer&&this.previewContext&&Pen.clearCanvas(this.previewLayer,this.previewContext)},this.resetView=()=>{this.drawLayer&&this.drawContext&&Pen.clearCanvas(this.drawLayer,this.drawContext)},this.resetCoordinates=()=>{this.previousCoordinates=[0,0],this.currentCoordinates=[0,0]},this.highlightPreview=()=>{this.previewContext&&(this.previewContext.strokeStyle="red",this.previewContext.setLineDash([10,10]),this.previewContext.lineWidth=3)},this.unHighlightpreview=()=>{this.previewContext&&this.previewContext.clearRect(0,0,this.self.width,this.self.height)},this.getCoords=e=>[e.offsetX-this.offset[0],e.offsetY-this.offset[1]],this.updateShapeData=e=>{throw new Error("not implemented")},this.executeAction=()=>{throw new Error("not implemented")},this.destroy=()=>{throw new Error("not implemented")},this.drawLayer=e,this.onUpdateEditor=i,this.self=t,this.footerFields=r,this.offset=null!=o?o:[e.offsetLeft,e.offsetTop],this.previewLayer=s,this.previewPenConfig=null!=a?a:highlightStyle,this.drawPenConfig=n,this.previewContext=null!==(d=null===(l=this.previewLayer)||void 0===l?void 0:l.getContext("2d"))&&void 0!==d?d:null,this.drawContext=this.drawLayer.getContext("2d")}}var _DrawTool_handleTimeOut,_DrawTool_draw,_DrawTool_onDown,_DrawTool_onUp,_DrawTool_onOut,_DrawTool_onMove;class DrawTool extends Tool{constructor(e,t,i,o,s,n){super(e,i,o,n,t,s),this.timesPerSecond=120,this.currentShapeComponents=[],_DrawTool_handleTimeOut.set(this,(()=>{this.shallWait=!0,setTimeout((()=>{this.shallWait=!1}),1e3/this.timesPerSecond)})),_DrawTool_draw.set(this,(()=>{this.currentShape&&Pen.drawLine(this.currentShape,this.previewContext)})),_DrawTool_onDown.set(this,(e=>{0===e.button&&(this.isDrawing=!0,this.currentShapeComponents=[],this.previousCoordinates=this.currentCoordinates,this.currentCoordinates=this.getCoords(e))})),_DrawTool_onUp.set(this,(()=>{if(this.currentShapeComponents.length>2){const e=new Freehand(this.currentShapeComponents,this.drawPenConfig);this.onUpdateEditor(e)}this.currentShapeComponents=[],this.isDrawing=!1})),_DrawTool_onOut.set(this,(()=>{this.isDrawing=!1})),_DrawTool_onMove.set(this,(e=>{this.isDrawing&&!this.shallWait&&(this.previousCoordinates=this.currentCoordinates,this.currentCoordinates=this.getCoords(e),this.currentShape=new Line(this.previousCoordinates,this.currentCoordinates,this.drawPenConfig,!1),Pen.drawLine(this.currentShape,this.previewContext),this.currentShapeComponents.push(this.currentCoordinates),__classPrivateFieldGet(this,_DrawTool_draw,"f").call(this),__classPrivateFieldGet(this,_DrawTool_handleTimeOut,"f").call(this))})),this.executeAction=()=>{this.drawLayer.addEventListener("mousemove",__classPrivateFieldGet(this,_DrawTool_onMove,"f")),this.drawLayer.addEventListener("mousedown",__classPrivateFieldGet(this,_DrawTool_onDown,"f")),this.drawLayer.addEventListener("mouseup",__classPrivateFieldGet(this,_DrawTool_onUp,"f")),this.drawLayer.addEventListener("mouseout",__classPrivateFieldGet(this,_DrawTool_onOut,"f"))},this.destroy=()=>{this.drawLayer.removeEventListener("mousemove",__classPrivateFieldGet(this,_DrawTool_onMove,"f")),this.drawLayer.removeEventListener("mousedown",__classPrivateFieldGet(this,_DrawTool_onDown,"f")),this.drawLayer.removeEventListener("mouseup",__classPrivateFieldGet(this,_DrawTool_onUp,"f")),this.drawLayer.removeEventListener("mouseout",__classPrivateFieldGet(this,_DrawTool_onOut,"f"))},this.resetPreview(),this.toolName=Tools_List.DRAW}}_DrawTool_handleTimeOut=new WeakMap,_DrawTool_draw=new WeakMap,_DrawTool_onDown=new WeakMap,_DrawTool_onUp=new WeakMap,_DrawTool_onOut=new WeakMap,_DrawTool_onMove=new WeakMap;const generateEllipse=(e,t,i,o)=>{const s=[(e[0]+t[0])/2,(e[1]+t[1])/2],n=calculateDistanceBetweenPoints(s,[t[0],(e[1]+t[1])/2]),a=calculateDistanceBetweenPoints(s,[(e[0]+t[0])/2,t[1]]);return new Ellipse(s,n,a,i,o)},generateCircle=(e,t,i,o)=>{const s=e,n=calculateDistanceBetweenPoints(e,t);return new Ellipse(s,n,n,i,o)};var _EllipseTool_draw,_EllipseTool_onKeyDown,_EllipseTool_onKeyUp,_EllipseTool_onDown,_EllipseTool_onUp,_EllipseTool_onMove,_EllipseTool_onOut,_LineTool_draw,_LineTool_onDown,_LineTool_onUp,_LineTool_onMove,_LineTool_onOut;class EllipseTool extends Tool{constructor(e,t,i,o,s,n){super(e,i,o,n,t,s,highlightStyle),this.isCircle=!1,_EllipseTool_draw.set(this,(()=>{this.currentShape&&Pen.drawEllipse(this.currentShape,this.drawContext,this.drawPenConfig),this.resetPreview()})),_EllipseTool_onKeyDown.set(this,(e=>{e.ctrlKey&&(this.isCircle=!0)})),_EllipseTool_onKeyUp.set(this,(()=>{this.isCircle=!1})),_EllipseTool_onDown.set(this,(e=>{0===e.button&&(this.isDrawing=!0,this.previousCoordinates=this.getCoords(e))})),_EllipseTool_onUp.set(this,(e=>{this.isDrawing=!1,this.currentCoordinates=this.getCoords(e),this.isCircle?this.currentShape=generateCircle(this.previousCoordinates,this.currentCoordinates,this.drawPenConfig):this.currentShape=generateEllipse(this.previousCoordinates,this.currentCoordinates,this.drawPenConfig),this.onUpdateEditor(this.currentShape),__classPrivateFieldGet(this,_EllipseTool_draw,"f").call(this)})),_EllipseTool_onMove.set(this,(e=>{if(this.currentCoordinates=this.getCoords(e),this.resetPreview(),this.isDrawing&&this.previewLayer)if(this.isCircle){const e=generateCircle(this.previousCoordinates,this.currentCoordinates,this.previewPenConfig,!1);this.currentShape=e,Pen.drawEllipse(e,this.previewContext)}else{const e=generateEllipse(this.previousCoordinates,this.currentCoordinates,this.previewPenConfig,!1);this.currentShape=e,Pen.drawEllipse(e,this.previewContext)}})),_EllipseTool_onOut.set(this,(()=>{this.isDrawing=!1})),this.executeAction=()=>{this.drawLayer.addEventListener("mousemove",__classPrivateFieldGet(this,_EllipseTool_onMove,"f")),this.drawLayer.addEventListener("mousedown",__classPrivateFieldGet(this,_EllipseTool_onDown,"f")),this.drawLayer.addEventListener("mouseup",__classPrivateFieldGet(this,_EllipseTool_onUp,"f")),this.drawLayer.addEventListener("mouseout",__classPrivateFieldGet(this,_EllipseTool_onOut,"f")),window.addEventListener("keydown",__classPrivateFieldGet(this,_EllipseTool_onKeyDown,"f")),window.addEventListener("keyup",__classPrivateFieldGet(this,_EllipseTool_onKeyUp,"f"))},this.destroy=()=>{this.drawLayer.removeEventListener("mousemove",__classPrivateFieldGet(this,_EllipseTool_onMove,"f")),this.drawLayer.removeEventListener("mousedown",__classPrivateFieldGet(this,_EllipseTool_onDown,"f")),this.drawLayer.removeEventListener("mouseup",__classPrivateFieldGet(this,_EllipseTool_onUp,"f")),this.drawLayer.removeEventListener("mouseout",__classPrivateFieldGet(this,_EllipseTool_onOut,"f")),window.removeEventListener("keydown",__classPrivateFieldGet(this,_EllipseTool_onKeyDown,"f")),window.removeEventListener("keyup",__classPrivateFieldGet(this,_EllipseTool_onKeyUp,"f"))},this.resetPreview();const a=this.drawLayer.getContext("2d");a&&(this.drawContext=a),this.toolName=Tools_List.ELLIPSE}}_EllipseTool_draw=new WeakMap,_EllipseTool_onKeyDown=new WeakMap,_EllipseTool_onKeyUp=new WeakMap,_EllipseTool_onDown=new WeakMap,_EllipseTool_onUp=new WeakMap,_EllipseTool_onMove=new WeakMap,_EllipseTool_onOut=new WeakMap;class LineTool extends Tool{constructor(e,t,i,o,s,n){super(e,i,o,n,t,s),_LineTool_draw.set(this,(()=>{this.currentShape&&Pen.drawLine(this.currentShape,this.drawContext)})),_LineTool_onDown.set(this,(e=>{0===e.button&&(this.isDrawing=!0,this.highlightPreview(),this.previousCoordinates=this.getCoords(e))})),_LineTool_onUp.set(this,(e=>{this.isDrawing=!1,this.currentCoordinates=this.getCoords(e),this.currentShape=new Line([this.previousCoordinates[0],this.previousCoordinates[1]],[this.currentCoordinates[0],this.currentCoordinates[1]],this.drawPenConfig),this.resetPreview(),this.unHighlightpreview(),__classPrivateFieldGet(this,_LineTool_draw,"f").call(this),this.onUpdateEditor(this.currentShape)})),_LineTool_onMove.set(this,(e=>{this.isDrawing&&this.previewLayer&&(this.resetPreview(),this.currentCoordinates=this.getCoords(e),this.currentShape=new Line(this.previousCoordinates,this.currentCoordinates,this.previewPenConfig,!1),Pen.drawLine(this.currentShape,this.previewContext))})),_LineTool_onOut.set(this,(()=>{this.isDrawing=!1})),this.executeAction=()=>{this.drawLayer.addEventListener("mousemove",__classPrivateFieldGet(this,_LineTool_onMove,"f")),this.drawLayer.addEventListener("mousedown",__classPrivateFieldGet(this,_LineTool_onDown,"f")),this.drawLayer.addEventListener("mouseout",__classPrivateFieldGet(this,_LineTool_onOut,"f")),this.drawLayer.addEventListener("mouseup",__classPrivateFieldGet(this,_LineTool_onUp,"f"))},this.destroy=()=>{this.drawLayer.removeEventListener("mousemove",__classPrivateFieldGet(this,_LineTool_onMove,"f")),this.drawLayer.removeEventListener("mousedown",__classPrivateFieldGet(this,_LineTool_onDown,"f")),this.drawLayer.removeEventListener("mouseout",__classPrivateFieldGet(this,_LineTool_onOut,"f")),this.drawLayer.removeEventListener("mouseup",__classPrivateFieldGet(this,_LineTool_onUp,"f"))},this.resetPreview();const a=this.drawLayer.getContext("2d");a&&(this.drawContext=a),this.toolName=Tools_List.LINE}}_LineTool_draw=new WeakMap,_LineTool_onDown=new WeakMap,_LineTool_onUp=new WeakMap,_LineTool_onMove=new WeakMap,_LineTool_onOut=new WeakMap;const paramFieldStateHandler=e=>({setAreFieldsEnabled:(t,i=!0)=>{t.forEach((t=>{var o,s,n,a;const r=[SVGParamFieldID.STROKE_OPACITY,SVGParamFieldID.FILL_OPACITY].includes(t),l=null===(s=null===(o=null==e?void 0:e.shadowRoot)||void 0===o?void 0:o.getElementById("footer-input"))||void 0===s?void 0:s.querySelector("#"+t);i?(null==l||l.removeAttribute("disabled"),r&&(null===(n=null==l?void 0:l.previousElementSibling)||void 0===n||n.removeAttribute("disabled"))):(null==l||l.setAttribute("disabled",""),r&&(null===(a=null==l?void 0:l.previousElementSibling)||void 0===a||a.setAttribute("disabled","")))}))}}),setTextParamsSourceVisibility=(e,t)=>{var i;const o=null===(i=null==e?void 0:e.shadowRoot)||void 0===i?void 0:i.getElementById("right-input-section");o&&(o.style.visibility=t?"visible":"hidden",t?o.removeAttribute("disabled"):o.setAttribute("disabled",""))};var _MoveTool_dCenter,_MoveTool_onDown,_MoveTool_onMove,_MoveTool_onUp,_MoveTool_onOut;class MoveTool extends Tool{constructor(e,t,i,o,s,n,a){super(e,i,o,s,t,void 0,void 0,a),_MoveTool_dCenter.set(this,void 0),_MoveTool_onDown.set(this,(e=>{var t,i;if(0!==e.button)return;this.previousCoordinates=this.currentCoordinates,this.currentCoordinates=this.getCoords(e);const o=null!==(i=null===(t=this.currentShape)||void 0===t?void 0:t.getCenter())&&void 0!==i?i:[0,0];__classPrivateFieldSet(this,_MoveTool_dCenter,[this.currentCoordinates[0]-o[0],this.currentCoordinates[1]-o[1]],"f"),this.currentShape&&isPointInsideAnotherShape(this.currentCoordinates)(this.currentShape)?this.isDrawing=!0:this.isDrawing=!1})),this.updatePreview=()=>{this.currentShape&&this.previewContext?(this.resetPreview(),rectangleParamsFromBoundaries(this.currentShape.boundaries),isText(this.currentShape)?(setTextParamsSourceVisibility(this.footerFields,!0),Pen.draw(this.currentShape,Object.assign(Object.assign(Object.assign({},this.currentShape.getSvgParams()),highlightStyle),{lineDash:[0]}),this.previewContext)):Pen.draw(this.currentShape,highlightStyle,this.previewContext)):this.resetPreview()},_MoveTool_onMove.set(this,(e=>{var t,i,o,s,n;this.isDrawing&&(this.previousCoordinates=this.currentCoordinates,this.currentCoordinates=this.getCoords(e),null===(t=this.currentShape)||void 0===t||t.moveTo([this.currentCoordinates[0]-(null!==(o=null===(i=__classPrivateFieldGet(this,_MoveTool_dCenter,"f"))||void 0===i?void 0:i[0])&&void 0!==o?o:0),this.currentCoordinates[1]-(null!==(n=null===(s=__classPrivateFieldGet(this,_MoveTool_dCenter,"f"))||void 0===s?void 0:s[1])&&void 0!==n?n:0)]),this.updatePreview())})),_MoveTool_onUp.set(this,(()=>{this.isDrawing=!1,this.currentShape&&(this.onUpdateEditor(this.currentShape),this.updatePreview())})),this.changeStyle=e=>{this.currentShape&&(this.currentShape.updateSVGParams(e),this.resetPreview(),this.updatePreview())},_MoveTool_onOut.set(this,(()=>{this.isDrawing=!1})),this.executeAction=()=>{this.drawLayer.addEventListener("mousedown",__classPrivateFieldGet(this,_MoveTool_onDown,"f")),this.drawLayer.addEventListener("mousemove",__classPrivateFieldGet(this,_MoveTool_onMove,"f")),this.drawLayer.addEventListener("mouseout",__classPrivateFieldGet(this,_MoveTool_onOut,"f")),this.drawLayer.addEventListener("mouseup",__classPrivateFieldGet(this,_MoveTool_onUp,"f"))},this.destroy=()=>{this.drawLayer.removeEventListener("mousedown",__classPrivateFieldGet(this,_MoveTool_onDown,"f")),this.drawLayer.removeEventListener("mousemove",__classPrivateFieldGet(this,_MoveTool_onMove,"f")),this.drawLayer.removeEventListener("mouseout",__classPrivateFieldGet(this,_MoveTool_onOut,"f")),this.drawLayer.removeEventListener("mouseup",__classPrivateFieldGet(this,_MoveTool_onUp,"f"))};const r=this.drawLayer.getContext("2d");r&&(this.drawContext=r),this.currentShape=n,this.updatePreview(),this.toolName=Tools_List.MOVE}}_MoveTool_dCenter=new WeakMap,_MoveTool_onDown=new WeakMap,_MoveTool_onMove=new WeakMap,_MoveTool_onUp=new WeakMap,_MoveTool_onOut=new WeakMap;const getFormattedRectangleValuesFromPoints=(e,t)=>{const i=Math.abs(t[0]-e[0]),o=Math.abs(t[1]-e[1]);return{startingCorner:[Math.min(e[0],t[0]),Math.min(e[1],t[1])],width:i,height:o}};var _RectangleTool_onOut,_SelectTool_onClick,_SelectTool_onDown,_SelectTool_onZoneSelection,_SelectTool_onUp,_SelectTool_onMove,_TextTool_onClick,_Editor_selectedTool,_Editor_drawLayer,_Editor_previewLayer,_Editor_connection,_Editor_self,_Editor_footerFieldsRef,_Editor_offset,_Editor_shapes,_Editor_currentParams,_Editor_isShapeOnlyBeingSelected,_Editor_setAreFieldsEnabled,_Editor_selectedShape,_Editor_drawContext,_Editor_previewContext,_Editor_createShape,_Editor_deleteShapeById,_Editor_handleUpdateShapes,_Editor_onHandleSelectShape,_Editor_onMoveShape,_Editor_openDownloadDialog,WS_EVENTS,_ConnectionMonitor_ws,_Connection_userName,_Connection_chatLog,_Connection_userId,_Connection_url,_Connection_port,_Connection_roomId,_Connection_keeper,_Connection_status,_Connection_onConnected,_Connection_parseResponse,_Connection_startKeepingConnectionAlive,_Connection_createNewWebSocket,_Connection_sendShapeWithLock;class RectangleTool extends Tool{constructor(e,t,i,o,s,n){super(e,i,o,n,t,s),this.onDown=e=>{0===e.button&&(this.highlightPreview(),this.currentCoordinates=this.getCoords(e),this.previousCoordinates=this.currentCoordinates,this.isDrawing=!0)},this.onUp=()=>{this.resetPreview(),this.resetView(),this.isDrawing=!1,this.currentShape&&(this.createRectangle(),this.onUpdateEditor(this.currentShape)),this.resetCoordinates()},this.createRectangle=()=>{const{startingCorner:e,width:t,height:i}=getFormattedRectangleValuesFromPoints(this.previousCoordinates,this.currentCoordinates);this.currentShape=new Rectangle(e,t,i,this.drawPenConfig)},this.createRectanglePreview=()=>{const{startingCorner:e,width:t,height:i}=getCanvasRectangleValuesFromPoints(this.previousCoordinates,this.currentCoordinates);this.currentShape=new Rectangle(e,t,i,this.previewPenConfig,!1)},this.onMove=e=>{this.isDrawing&&(this.currentCoordinates=this.getCoords(e),this.createRectanglePreview(),this.currentShape&&(this.resetPreview(),Pen.drawRectangle(this.currentShape,this.previewContext,this.previewPenConfig)))},_RectangleTool_onOut.set(this,(()=>{this.isDrawing=!1})),this.executeAction=()=>{this.drawLayer.addEventListener("mousemove",this.onMove),this.drawLayer.addEventListener("mousedown",this.onDown),this.drawLayer.addEventListener("mouseout",__classPrivateFieldGet(this,_RectangleTool_onOut,"f")),this.drawLayer.addEventListener("mouseup",this.onUp)},this.destroy=()=>{this.drawLayer.removeEventListener("mousemove",this.onMove),this.drawLayer.removeEventListener("mousedown",this.onDown),this.drawLayer.removeEventListener("mouseout",__classPrivateFieldGet(this,_RectangleTool_onOut,"f")),this.drawLayer.removeEventListener("mouseup",this.onUp)},this.resetPreview();const a=this.drawLayer.getContext("2d");a&&(this.drawContext=a),this.toolName=Tools_List.RECT}}_RectangleTool_onOut=new WeakMap;class SelectTool extends Tool{constructor(e,t,i,o,s,n,a){super(e,i,o,n,t,void 0,void 0,a),this.updateAllShapes=(e=[])=>{this.allShapes=e},_SelectTool_onClick.set(this,(e=>{this.currentCoordinates=this.getCoords(e);const t=isPointInsideAnotherShape(this.currentCoordinates),i=this.allShapes.filter((e=>t(e)&&!e.isLocked));if(!i.length)return this.currentShape=void 0,void this.updatePreview();const o=null==i?void 0:i.reduce(((e,t)=>t.index>(null==e?void 0:e.index)?e:t));this.currentShape=o,this.updatePreview()})),_SelectTool_onDown.set(this,(e=>{0===e.button&&(this.unHighlightpreview(),this.currentShape=void 0,this.currentCoordinates=this.getCoords(e),this.previousCoordinates=this.currentCoordinates,this.isDrawing=!0)})),this.updatePreview=()=>{if(this.currentShape&&this.previewContext){this.resetPreview();const{startingCorner:e,width:t,height:i}=rectangleParamsFromBoundaries(this.currentShape.boundaries);isText(this.currentShape)?(setTextParamsSourceVisibility(this.footerFields,!0),Pen.draw(this.currentShape,Object.assign(Object.assign(Object.assign({},this.currentShape.getSvgParams()),highlightStyle),{lineDash:[0]}),this.previewContext)):(Pen.draw(this.currentShape,highlightStyle,this.previewContext),Pen.draw(new Rectangle(e,t,i,highlightStyle,!1),void 0,this.previewContext))}else this.resetPreview()},_SelectTool_onZoneSelection.set(this,(e=>{const t=isShapeInsideAnotherShape(e),i=this.allShapes.filter((e=>!e.isLocked)).filter(t),o=Math.max(...i.map((e=>e.index))),s=i.find((e=>e.index===o));s&&typeOfShape(s)&&this.previewContext?(this.currentShape=s,this.updatePreview()):this.currentShape=void 0})),_SelectTool_onUp.set(this,(e=>{var t;this.resetPreview(),this.isDrawing=!1,this.currentShape?__classPrivateFieldGet(this,_SelectTool_onZoneSelection,"f").call(this,this.currentShape):__classPrivateFieldGet(this,_SelectTool_onClick,"f").call(this,e),this.onUpdateEditor(null!==(t=this.currentShape)&&void 0!==t?t:null)})),_SelectTool_onMove.set(this,(e=>{if(this.isDrawing&&this.previewLayer){this.currentCoordinates=this.getCoords(e);const{startingCorner:t,width:i,height:o}=getCanvasRectangleValuesFromPoints(this.previousCoordinates,this.currentCoordinates);this.currentShape=new Rectangle(t,i,o,highlightStyle,!1),this.currentShape&&(this.resetPreview(),Pen.drawRectangle(this.currentShape,this.previewContext))}})),this.changeStyle=e=>{this.currentShape&&(this.currentShape.updateSVGParams(e),this.resetPreview(),this.updatePreview())},this.executeAction=()=>{this.drawLayer.addEventListener("mousemove",__classPrivateFieldGet(this,_SelectTool_onMove,"f")),this.drawLayer.addEventListener("mousedown",__classPrivateFieldGet(this,_SelectTool_onDown,"f")),this.drawLayer.addEventListener("mouseup",__classPrivateFieldGet(this,_SelectTool_onUp,"f"))},this.destroy=()=>{this.drawLayer.removeEventListener("mousemove",__classPrivateFieldGet(this,_SelectTool_onMove,"f")),this.drawLayer.removeEventListener("mousedown",__classPrivateFieldGet(this,_SelectTool_onDown,"f")),this.drawLayer.removeEventListener("mouseup",__classPrivateFieldGet(this,_SelectTool_onUp,"f"))},this.allShapes=s,this.previewContext&&this.previewContext.setLineDash([10,10]),this.toolName=Tools_List.SELECT}}_SelectTool_onClick=new WeakMap,_SelectTool_onDown=new WeakMap,_SelectTool_onZoneSelection=new WeakMap,_SelectTool_onUp=new WeakMap,_SelectTool_onMove=new WeakMap;class TextTool extends Tool{constructor(e,t,i,o,s,n,a){super(e,i,o,n,t,s,void 0,a),_TextTool_onClick.set(this,(e=>{var t;if(0!==e.button)return;const i=this.getCoords(e);if(this.previewContext&&(null===(t=this.drawPenConfig)||void 0===t?void 0:t.text)){const e=measureText(this.drawPenConfig.text,{fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0)",fontSize:this.drawPenConfig.fontSize,fontFamily:this.drawPenConfig.fontFamily},void 0,this.drawContext);if(this.resetPreview(),e){const t=new TextShape(e.width,e.height,i,Object.assign({fontFamily:this.drawPenConfig.fontFamily,fontSize:this.drawPenConfig.fontSize,text:this.drawPenConfig.text},this.drawPenConfig));this.onUpdateEditor(t)}}})),this.updateText=e=>{this.drawPenConfig.text=e},this.executeAction=()=>{this.drawLayer.addEventListener("click",__classPrivateFieldGet(this,_TextTool_onClick,"f"))},this.destroy=()=>{setTextParamsSourceVisibility(this.footerFields,!1),this.drawLayer.removeEventListener("click",__classPrivateFieldGet(this,_TextTool_onClick,"f"))},setTextParamsSourceVisibility(a,!0),this.drawPenConfig.text||(this.drawPenConfig.text="Input text..."),this.toolName=Tools_List.TEXT}}_TextTool_onClick=new WeakMap;class Editor{constructor(e,t,i,o,s){var n,a,r;_Editor_selectedTool.set(this,null),_Editor_drawLayer.set(this,null),_Editor_previewLayer.set(this,null),_Editor_connection.set(this,void 0),_Editor_self.set(this,void 0),_Editor_footerFieldsRef.set(this,void 0),_Editor_offset.set(this,void 0),_Editor_shapes.set(this,[]),_Editor_currentParams.set(this,defaultSVGParams),_Editor_isShapeOnlyBeingSelected.set(this,!1),_Editor_setAreFieldsEnabled.set(this,void 0),_Editor_selectedShape.set(this,null),_Editor_drawContext.set(this,void 0),_Editor_previewContext.set(this,void 0),_Editor_createShape.set(this,(e=>{switch(e.type){case"Ellipse":{const{id:t,center:i,radiusX:o,radiusY:s,isLocked:n,svgParams:a}=e;return new Ellipse(i,o,s,a,!0,n).replaceID(t)}case"Rectangle":const{width:t,height:i,id:o,startingCorner:s,isLocked:n,svgParams:a}=e;return new Rectangle(s,t,i,a,!0,n).replaceID(o);case"TextShape":{const{id:t,width:i,height:o,position:s,svgParams:n,isLocked:a}=e;return new TextShape(i,o,s,n,!0,a).replaceID(t)}case"Freehand":{const{id:t,isLocked:i,svgParams:o,points:s}=e;return new Freehand(s,o,!0,i).replaceID(t)}case"Line":{const{id:t,isLocked:i,startPoint:o,endPoint:s,svgParams:n}=e;return new Line(o,s,n,!0,i).replaceID(t)}}})),_Editor_deleteShapeById.set(this,(e=>{var t;const i=__classPrivateFieldGet(this,_Editor_shapes,"f").findIndex((t=>t.getId()===e));__classPrivateFieldGet(this,_Editor_shapes,"f").splice(i,1),null===(t=__classPrivateFieldGet(this,_Editor_connection,"f"))||void 0===t||t.deleteShapes([e])})),_Editor_handleUpdateShapes.set(this,(e=>{var t;if(void 0===e)return;if(null===e)return void this.onUnselectTool();const i=Array.isArray(e)?e:[e];this.updateShapes(i),null===(t=__classPrivateFieldGet(this,_Editor_connection,"f"))||void 0===t||t.updateShapes(e)})),_Editor_onHandleSelectShape.set(this,(e=>{var t,i,o,s;if(setIsButtonDisabled(__classPrivateFieldGet(this,_Editor_self,"f"),Tools_List.MOVE,!e),__classPrivateFieldSet(this,_Editor_isShapeOnlyBeingSelected,!0,"f"),!e&&__classPrivateFieldGet(this,_Editor_selectedShape,"f")){null===(t=__classPrivateFieldGet(this,_Editor_connection,"f"))||void 0===t||t.unlockShapes(__classPrivateFieldGet(this,_Editor_selectedShape,"f"));const e=__classPrivateFieldGet(this,_Editor_selectedShape,"f");(null===(i=__classPrivateFieldGet(this,_Editor_connection,"f"))||void 0===i?void 0:i.ws)&&(__classPrivateFieldGet(this,_Editor_connection,"f").ws.onclose=()=>{var t;return null===(t=__classPrivateFieldGet(this,_Editor_connection,"f"))||void 0===t?void 0:t.unlockShapes(e)}),__classPrivateFieldSet(this,_Editor_selectedShape,null,"f")}else{const t=Array.isArray(e)?e[0]:e;t&&(null===(o=__classPrivateFieldGet(this,_Editor_connection,"f"))||void 0===o||o.lockShapes(t)),__classPrivateFieldSet(this,_Editor_selectedShape,t,"f"),__classPrivateFieldGet(this,_Editor_selectedShape,"f")&&(__classPrivateFieldSet(this,_Editor_currentParams,__classPrivateFieldGet(this,_Editor_selectedShape,"f").getSvgParams(),"f"),this.onUpdateStyleInputFields(),isText(__classPrivateFieldGet(this,_Editor_selectedShape,"f"))&&setTextParamsSourceVisibility(__classPrivateFieldGet(this,_Editor_footerFieldsRef,"f"),!0)),__classPrivateFieldSet(this,_Editor_isShapeOnlyBeingSelected,!1,"f")}e&&(setIsButtonActive(__classPrivateFieldGet(this,_Editor_self,"f"),Tools_List.SELECT,!1),null===(s=__classPrivateFieldGet(this,_Editor_selectedTool,"f"))||void 0===s||s.destroy(),__classPrivateFieldSet(this,_Editor_selectedTool,null,"f"))})),_Editor_onMoveShape.set(this,(e=>{var t;if(null===e)return void this.onUnselectTool();const i=Array.isArray(e)?e[0]:e,o=__classPrivateFieldGet(this,_Editor_shapes,"f").findIndex((e=>e.getId()===i.getId()));o>=0?__classPrivateFieldGet(this,_Editor_shapes,"f")[o]=i:__classPrivateFieldGet(this,_Editor_shapes,"f").push(i),this.redrawShapes(),null===(t=__classPrivateFieldGet(this,_Editor_connection,"f"))||void 0===t||t.updateShapes(e)})),_Editor_openDownloadDialog.set(this,(e=>{const t=document.createElement("a");t.download="svg-element.svg",t.href=e,document.body.appendChild(t),t.click(),document.body.removeChild(t)})),this.applyStyles=()=>{var e;__classPrivateFieldGet(this,_Editor_selectedShape,"f")&&__classPrivateFieldGet(this,_Editor_drawLayer,"f")&&(this.redrawShapes(),null===(e=__classPrivateFieldGet(this,_Editor_connection,"f"))||void 0===e||e.updateShapes(__classPrivateFieldGet(this,_Editor_shapes,"f")))},this.deleteFromShapes=e=>{Array.isArray(e)?e.forEach(__classPrivateFieldGet(this,_Editor_deleteShapeById,"f")):__classPrivateFieldGet(this,_Editor_deleteShapeById,"f").call(this,e)},this.getAllShapes=()=>__classPrivateFieldGet(this,_Editor_shapes,"f"),this.getSVGParams=()=>__classPrivateFieldGet(this,_Editor_currentParams,"f"),this.onUpdateStyleInputFields=()=>{var e,t;updateStyleInputFields(__classPrivateFieldGet(this,_Editor_footerFieldsRef,"f"),null!==(t=null===(e=__classPrivateFieldGet(this,_Editor_selectedShape,"f"))||void 0===e?void 0:e.getSvgParams())&&void 0!==t?t:__classPrivateFieldGet(this,_Editor_currentParams,"f"))},this.onDeleteSelectedShape=()=>{__classPrivateFieldGet(this,_Editor_selectedShape,"f")&&(this.deleteFromShapes(__classPrivateFieldGet(this,_Editor_selectedShape,"f").getId()),__classPrivateFieldSet(this,_Editor_selectedShape,null,"f"))},this.onImportSVG=e=>{__classPrivateFieldGet(this,_Editor_handleUpdateShapes,"f").call(this,importSVG(e))},this.onSave=()=>{this.onUnselectTool(),__classPrivateFieldGet(this,_Editor_openDownloadDialog,"f").call(this,generateSVGURLFromShapes(__classPrivateFieldGet(this,_Editor_shapes,"f")))},this.onSelectTool=e=>{var t,i,o,s,n,a;if((null===(t=__classPrivateFieldGet(this,_Editor_selectedTool,"f"))||void 0===t?void 0:t.toolName)&&setIsButtonActive(__classPrivateFieldGet(this,_Editor_self,"f"),null===(i=__classPrivateFieldGet(this,_Editor_selectedTool,"f"))||void 0===i?void 0:i.toolName,!1),e&&(__classPrivateFieldGet(this,_Editor_selectedShape,"f")&&e!==Tools_List.SELECT?(null===(o=__classPrivateFieldGet(this,_Editor_selectedTool,"f"))||void 0===o||o.destroy(),this.onUpdateStyleInputFields()):this.onUnselectTool()),__classPrivateFieldGet(this,_Editor_drawLayer,"f")&&__classPrivateFieldGet(this,_Editor_previewLayer,"f")){switch(__classPrivateFieldGet(this,_Editor_setAreFieldsEnabled,"f").call(this,Object.values(SVGParamFieldID),!0),e){case Tools_List.DRAW:{const e=[SVGParamFieldID.FILL_COLOR,SVGParamFieldID.FILL_OPACITY];__classPrivateFieldGet(this,_Editor_setAreFieldsEnabled,"f").call(this,e,!1),__classPrivateFieldSet(this,_Editor_selectedTool,new DrawTool(__classPrivateFieldGet(this,_Editor_drawLayer,"f"),__classPrivateFieldGet(this,_Editor_previewLayer,"f"),__classPrivateFieldGet(this,_Editor_self,"f"),__classPrivateFieldGet(this,_Editor_handleUpdateShapes,"f"),__classPrivateFieldGet(this,_Editor_currentParams,"f"),__classPrivateFieldGet(this,_Editor_offset,"f")),"f");break}case Tools_List.LINE:{const e=[SVGParamFieldID.FILL_COLOR,SVGParamFieldID.FILL_OPACITY];__classPrivateFieldGet(this,_Editor_setAreFieldsEnabled,"f").call(this,e,!1),__classPrivateFieldSet(this,_Editor_selectedTool,new LineTool(__classPrivateFieldGet(this,_Editor_drawLayer,"f"),__classPrivateFieldGet(this,_Editor_previewLayer,"f"),__classPrivateFieldGet(this,_Editor_self,"f"),__classPrivateFieldGet(this,_Editor_handleUpdateShapes,"f"),__classPrivateFieldGet(this,_Editor_currentParams,"f"),__classPrivateFieldGet(this,_Editor_offset,"f")),"f");break}case Tools_List.RECT:__classPrivateFieldSet(this,_Editor_selectedTool,new RectangleTool(__classPrivateFieldGet(this,_Editor_drawLayer,"f"),__classPrivateFieldGet(this,_Editor_previewLayer,"f"),__classPrivateFieldGet(this,_Editor_self,"f"),__classPrivateFieldGet(this,_Editor_handleUpdateShapes,"f"),__classPrivateFieldGet(this,_Editor_currentParams,"f"),__classPrivateFieldGet(this,_Editor_offset,"f")),"f");break;case Tools_List.ELLIPSE:__classPrivateFieldSet(this,_Editor_selectedTool,new EllipseTool(__classPrivateFieldGet(this,_Editor_drawLayer,"f"),__classPrivateFieldGet(this,_Editor_previewLayer,"f"),__classPrivateFieldGet(this,_Editor_self,"f"),__classPrivateFieldGet(this,_Editor_handleUpdateShapes,"f"),__classPrivateFieldGet(this,_Editor_currentParams,"f"),__classPrivateFieldGet(this,_Editor_offset,"f")),"f");break;case Tools_List.SELECT:__classPrivateFieldSet(this,_Editor_selectedTool,new SelectTool(__classPrivateFieldGet(this,_Editor_drawLayer,"f"),__classPrivateFieldGet(this,_Editor_previewLayer,"f"),__classPrivateFieldGet(this,_Editor_self,"f"),__classPrivateFieldGet(this,_Editor_onHandleSelectShape,"f"),__classPrivateFieldGet(this,_Editor_shapes,"f"),__classPrivateFieldGet(this,_Editor_offset,"f"),__classPrivateFieldGet(this,_Editor_footerFieldsRef,"f")),"f");break;case Tools_List.TEXT:__classPrivateFieldSet(this,_Editor_selectedTool,new TextTool(__classPrivateFieldGet(this,_Editor_drawLayer,"f"),__classPrivateFieldGet(this,_Editor_previewLayer,"f"),__classPrivateFieldGet(this,_Editor_self,"f"),__classPrivateFieldGet(this,_Editor_handleUpdateShapes,"f"),__classPrivateFieldGet(this,_Editor_currentParams,"f"),__classPrivateFieldGet(this,_Editor_offset,"f"),__classPrivateFieldGet(this,_Editor_footerFieldsRef,"f")),"f");break;case Tools_List.MOVE:if(!__classPrivateFieldGet(this,_Editor_selectedShape,"f"))return;__classPrivateFieldSet(this,_Editor_selectedTool,new MoveTool(__classPrivateFieldGet(this,_Editor_drawLayer,"f"),__classPrivateFieldGet(this,_Editor_previewLayer,"f"),__classPrivateFieldGet(this,_Editor_self,"f"),__classPrivateFieldGet(this,_Editor_onMoveShape,"f"),__classPrivateFieldGet(this,_Editor_offset,"f"),__classPrivateFieldGet(this,_Editor_selectedShape,"f"),__classPrivateFieldGet(this,_Editor_footerFieldsRef,"f")),"f");break;case Tools_List.DELETE:this.onDeleteSelectedShape(),this.onUnselectTool(),__classPrivateFieldSet(this,_Editor_selectedTool,null,"f");break;case null:(null===(s=__classPrivateFieldGet(this,_Editor_selectedTool,"f"))||void 0===s?void 0:s.toolName)&&setIsButtonActive(__classPrivateFieldGet(this,_Editor_self,"f"),__classPrivateFieldGet(this,_Editor_selectedTool,"f").toolName,!1),this.onUnselectTool(),__classPrivateFieldSet(this,_Editor_selectedTool,null,"f")}e&&e!==Tools_List.DELETE&&setIsButtonActive(__classPrivateFieldGet(this,_Editor_self,"f"),e,!0),isMoveTool(__classPrivateFieldGet(this,_Editor_selectedTool,"f"))||(__classPrivateFieldSet(this,_Editor_selectedShape,null,"f"),this.applyStyles()),null===(n=__classPrivateFieldGet(this,_Editor_self,"f").shadowRoot)||void 0===n||n.getElementById(""),null===(a=__classPrivateFieldGet(this,_Editor_selectedTool,"f"))||void 0===a||a.executeAction()}},this.onUnselectTool=()=>{var e,t;__classPrivateFieldGet(this,_Editor_selectedShape,"f")&&(null===(e=__classPrivateFieldGet(this,_Editor_connection,"f"))||void 0===e||e.unlockShapes(__classPrivateFieldGet(this,_Editor_selectedShape,"f"))),setIsButtonDisabled(__classPrivateFieldGet(this,_Editor_self,"f"),Tools_List.MOVE,!0),__classPrivateFieldSet(this,_Editor_selectedShape,null,"f"),null===(t=__classPrivateFieldGet(this,_Editor_selectedTool,"f"))||void 0===t||t.destroy(),__classPrivateFieldGet(this,_Editor_setAreFieldsEnabled,"f").call(this,Object.values(SVGParamFieldID),!1),setTextParamsSourceVisibility(__classPrivateFieldGet(this,_Editor_footerFieldsRef,"f"),!1),this.resetPreview(),this.redrawShapes()},this.redrawShapes=()=>{__classPrivateFieldGet(this,_Editor_drawContext,"f")&&__classPrivateFieldGet(this,_Editor_drawLayer,"f")&&__classPrivateFieldGet(this,_Editor_previewLayer,"f")&&__classPrivateFieldGet(this,_Editor_previewContext,"f")&&(Pen.clearCanvas(__classPrivateFieldGet(this,_Editor_drawLayer,"f"),__classPrivateFieldGet(this,_Editor_drawContext,"f")),Pen.clearCanvas(__classPrivateFieldGet(this,_Editor_previewLayer,"f"),__classPrivateFieldGet(this,_Editor_previewContext,"f")),__classPrivateFieldGet(this,_Editor_selectedShape,"f")&&("TextShape"===typeOfShape(__classPrivateFieldGet(this,_Editor_selectedShape,"f"))?Pen.draw(__classPrivateFieldGet(this,_Editor_selectedShape,"f"),Object.assign(Object.assign(Object.assign(Object.assign({},__classPrivateFieldGet(this,_Editor_selectedShape,"f").getSvgParams()),__classPrivateFieldGet(this,_Editor_currentParams,"f")),highlightStyle),{lineDash:[0]}),__classPrivateFieldGet(this,_Editor_previewContext,"f")):Pen.draw(__classPrivateFieldGet(this,_Editor_selectedShape,"f"),Object.assign(Object.assign(Object.assign({},__classPrivateFieldGet(this,_Editor_selectedShape,"f").getSvgParams()),__classPrivateFieldGet(this,_Editor_currentParams,"f")),highlightStyle),__classPrivateFieldGet(this,_Editor_previewContext,"f"))),__classPrivateFieldGet(this,_Editor_drawContext,"f")&&__classPrivateFieldGet(this,_Editor_shapes,"f").forEach((e=>{Pen.draw(e,void 0,__classPrivateFieldGet(this,_Editor_drawContext,"f"))})))},this.resetEditor=()=>{this.onUnselectTool(),__classPrivateFieldSet(this,_Editor_shapes,[],"f"),__classPrivateFieldSet(this,_Editor_currentParams,defaultSVGParams,"f"),__classPrivateFieldGet(this,_Editor_drawLayer,"f")&&Pen.clearCanvas(__classPrivateFieldGet(this,_Editor_drawLayer,"f")),__classPrivateFieldGet(this,_Editor_previewLayer,"f")&&Pen.clearCanvas(__classPrivateFieldGet(this,_Editor_previewLayer,"f"))},this.resetPreview=()=>{var e;const t=null===(e=__classPrivateFieldGet(this,_Editor_previewLayer,"f"))||void 0===e?void 0:e.getContext("2d");__classPrivateFieldGet(this,_Editor_previewLayer,"f")&&t&&Pen.clearCanvas(__classPrivateFieldGet(this,_Editor_previewLayer,"f"),t)},this.setConnection=e=>{__classPrivateFieldSet(this,_Editor_connection,e,"f")},this.setShapeParam=(e,t)=>{var i;__classPrivateFieldGet(this,_Editor_currentParams,"f")[e]=t,null===(i=__classPrivateFieldGet(this,_Editor_selectedShape,"f"))||void 0===i||i.updateSVGParam(e,t);const o=__classPrivateFieldGet(this,_Editor_shapes,"f").findIndex((e=>{var t;return(null===(t=__classPrivateFieldGet(this,_Editor_selectedShape,"f"))||void 0===t?void 0:t.getId())===e.getId()}));void 0!==o&&__classPrivateFieldGet(this,_Editor_shapes,"f")&&__classPrivateFieldGet(this,_Editor_selectedShape,"f")&&(__classPrivateFieldGet(this,_Editor_shapes,"f")[o]=__classPrivateFieldGet(this,_Editor_selectedShape,"f")),this.applyStyles()},this.setShapeParams=(e=!1,t,i="rgba(0,0,0,1)",o="rgba(0,0,0,0)",s="butt",n=[],a="Arial",r=12,l)=>{var d;e&&__classPrivateFieldGet(this,_Editor_isShapeOnlyBeingSelected,"f")||(__classPrivateFieldSet(this,_Editor_currentParams,{fill:o,stroke:i,strokeWidth:t,lineCap:s,lineDash:n,fontFamily:a,fontSize:r,text:l},"f"),null===(d=__classPrivateFieldGet(this,_Editor_selectedTool,"f"))||void 0===d||d.setSVGParams(__classPrivateFieldGet(this,_Editor_currentParams,"f")))},this.updateShapes=e=>{var t,i;if(e.length)if((i=e[0])&&void 0!==i.getDeconstructedShapeData)e.forEach((e=>{const t=__classPrivateFieldGet(this,_Editor_shapes,"f").findIndex((t=>t.getId()===(null==e?void 0:e.getId())));t>=0?__classPrivateFieldGet(this,_Editor_shapes,"f")[t]=e:__classPrivateFieldGet(this,_Editor_shapes,"f").push(e),__classPrivateFieldSet(this,_Editor_currentParams,e.getSvgParams(),"f")})),(null===(t=__classPrivateFieldGet(this,_Editor_selectedTool,"f"))||void 0===t?void 0:t.toolName)===Tools_List.SELECT&&__classPrivateFieldGet(this,_Editor_selectedTool,"f").updateAllShapes(__classPrivateFieldGet(this,_Editor_shapes,"f"));else{const t=e.map(__classPrivateFieldGet(this,_Editor_createShape,"f")).filter((e=>!!e));__classPrivateFieldSet(this,_Editor_shapes,t,"f")}else __classPrivateFieldSet(this,_Editor_shapes,[],"f"),__classPrivateFieldSet(this,_Editor_selectedShape,null,"f");this.redrawShapes()},__classPrivateFieldSet(this,_Editor_drawLayer,e,"f"),__classPrivateFieldSet(this,_Editor_previewLayer,t,"f"),__classPrivateFieldSet(this,_Editor_self,o,"f"),__classPrivateFieldSet(this,_Editor_offset,i,"f"),__classPrivateFieldSet(this,_Editor_footerFieldsRef,s,"f"),__classPrivateFieldSet(this,_Editor_currentParams,{text:"Input text...",strokeWidth:"1",stroke:"rgba(0,0,0,1)",fill:"rgba(0,0,0,0)"},"f"),__classPrivateFieldSet(this,_Editor_drawContext,null===(n=__classPrivateFieldGet(this,_Editor_drawLayer,"f"))||void 0===n?void 0:n.getContext("2d"),"f"),__classPrivateFieldSet(this,_Editor_previewContext,null===(a=__classPrivateFieldGet(this,_Editor_previewLayer,"f"))||void 0===a?void 0:a.getContext("2d"),"f"),__classPrivateFieldSet(this,_Editor_setAreFieldsEnabled,(r=__classPrivateFieldGet(this,_Editor_footerFieldsRef,"f"),{setAreFieldsEnabled:(e,t=!0)=>{e.forEach((e=>{var i,o,s,n;const a=[SVGParamFieldID.STROKE_OPACITY,SVGParamFieldID.FILL_OPACITY].includes(e),l=null===(o=null===(i=null==r?void 0:r.shadowRoot)||void 0===i?void 0:i.getElementById("footer-input"))||void 0===o?void 0:o.querySelector("#"+e);t?(null==l||l.removeAttribute("disabled"),a&&(null===(s=null==l?void 0:l.previousElementSibling)||void 0===s||s.removeAttribute("disabled"))):(null==l||l.setAttribute("disabled",""),a&&(null===(n=null==l?void 0:l.previousElementSibling)||void 0===n||n.setAttribute("disabled","")))}))}}).setAreFieldsEnabled,"f"),__classPrivateFieldGet(this,_Editor_setAreFieldsEnabled,"f").call(this,Object.values(SVGParamFieldID),!1),updateStyleInputFields(__classPrivateFieldGet(this,_Editor_footerFieldsRef,"f"),__classPrivateFieldGet(this,_Editor_currentParams,"f")),window.addEventListener("resize",(()=>{setTimeout((()=>this.redrawShapes()),50)}))}}_Editor_selectedTool=new WeakMap,_Editor_drawLayer=new WeakMap,_Editor_previewLayer=new WeakMap,_Editor_connection=new WeakMap,_Editor_self=new WeakMap,_Editor_footerFieldsRef=new WeakMap,_Editor_offset=new WeakMap,_Editor_shapes=new WeakMap,_Editor_currentParams=new WeakMap,_Editor_isShapeOnlyBeingSelected=new WeakMap,_Editor_setAreFieldsEnabled=new WeakMap,_Editor_selectedShape=new WeakMap,_Editor_drawContext=new WeakMap,_Editor_previewContext=new WeakMap,_Editor_createShape=new WeakMap,_Editor_deleteShapeById=new WeakMap,_Editor_handleUpdateShapes=new WeakMap,_Editor_onHandleSelectShape=new WeakMap,_Editor_onMoveShape=new WeakMap,_Editor_openDownloadDialog=new WeakMap,function(e){e.MESSAGE="message",e.PING="ping",e.PONG="pong",e.UPDATE_SHAPES="update-shapes",e.GET_SHAPES="get-shapes",e.DELETE_SHAPES="delete-shapes",e.LOCK_SHAPES="lock-shapes",e.UNLOCK_SHAPES="unlock-shapes",e.JOIN_ROOM="join-room",e.DISCONNECT="disconnect",e.ERROR="error"}(WS_EVENTS||(WS_EVENTS={}));class ConnectionMonitor{constructor(e){_ConnectionMonitor_ws.set(this,void 0),this.destroy=()=>{__classPrivateFieldGet(this,_ConnectionMonitor_ws,"f").removeEventListener("message",(e=>{if(JSON.parse(e.data).event===WS_EVENTS.PING){const e=JSON.stringify({event:WS_EVENTS.PONG});__classPrivateFieldGet(this,_ConnectionMonitor_ws,"f").send(e)}}))},__classPrivateFieldSet(this,_ConnectionMonitor_ws,e,"f"),e.addEventListener("message",(t=>{if(JSON.parse(t.data).event===WS_EVENTS.PING){const t=JSON.stringify({event:WS_EVENTS.PONG});e.send(t)}}))}}_ConnectionMonitor_ws=new WeakMap;class Connection{constructor(e,t,i,o,s,n,a,r,l){_Connection_userName.set(this,"user_"+nanoid(5)),_Connection_chatLog.set(this,[]),_Connection_userId.set(this,void 0),_Connection_url.set(this,void 0),_Connection_port.set(this,void 0),_Connection_roomId.set(this,""),this.ws=null,_Connection_keeper.set(this,void 0),_Connection_status.set(this,"disconnected"),_Connection_onConnected.set(this,void 0),this.disconnect=()=>{var e,t;null===(e=this.ws)||void 0===e||e.close(),null===(t=__classPrivateFieldGet(this,_Connection_keeper,"f"))||void 0===t||t.destroy(),this.updateStatus("disconnected"),this.onResetEditor()},this.getRoom=()=>__classPrivateFieldGet(this,_Connection_roomId,"f"),this.getChatLog=()=>__classPrivateFieldGet(this,_Connection_chatLog,"f"),this.getUserName=()=>__classPrivateFieldGet(this,_Connection_userName,"f"),_Connection_parseResponse.set(this,(e=>{var t;const i=JSON.parse(e.data);if(i.event===WS_EVENTS.PING||i.event===WS_EVENTS.PONG)return i;const{value:o}=i,s=__rest(i,["value"]),n="string"==typeof o?o:null===(t=JSON.parse(o))||void 0===t?void 0:t.map((e=>JSON.parse(e)));return Object.assign(Object.assign({},s),{value:n})})),_Connection_startKeepingConnectionAlive.set(this,(e=>(__classPrivateFieldGet(this,_Connection_keeper,"f")&&__classPrivateFieldGet(this,_Connection_keeper,"f").destroy(),__classPrivateFieldSet(this,_Connection_keeper,new ConnectionMonitor(e),"f"),__classPrivateFieldGet(this,_Connection_keeper,"f")))),_Connection_createNewWebSocket.set(this,(()=>{const e=this,t=new WebSocket(`ws://${__classPrivateFieldGet(this,_Connection_url,"f")}:${__classPrivateFieldGet(this,_Connection_port,"f")}`);this.ws=t,t.addEventListener("open",(()=>{const i={event:WS_EVENTS.JOIN_ROOM,roomId:__classPrivateFieldGet(e,_Connection_roomId,"f"),value:JSON.stringify(e.onGetAllShapes().map((e=>e.getDeconstructedShapeData()))),user:__classPrivateFieldGet(e,_Connection_userName,"f")};__classPrivateFieldGet(e,_Connection_onConnected,"f").call(e,e),e.updateStatus("connected"),t.send(JSON.stringify(i)),e.sendChatMessage("Connected to session.")})),t.addEventListener("close",(()=>{this.disconnect()})),t.addEventListener("message",(t=>{var i,o;const s=__classPrivateFieldGet(this,_Connection_parseResponse,"f").call(this,t),{value:n,event:a,user:r}=s;switch(a){case WS_EVENTS.MESSAGE:r&&n&&(null===(i=__classPrivateFieldGet(e,_Connection_chatLog,"f"))||void 0===i||i.push({userName:r,message:n}),e.onNewMessage(__classPrivateFieldGet(e,_Connection_chatLog,"f")));break;case WS_EVENTS.GET_SHAPES:e.onUpdateShapes(null!==(o=JSON.parse(n))&&void 0!==o?o:[]);break;case WS_EVENTS.ERROR:alert("Error while communicating with the server. Please refresh the connection.")}})),__classPrivateFieldGet(this,_Connection_startKeepingConnectionAlive,"f").call(this,t),__classPrivateFieldSet(this,_Connection_keeper,__classPrivateFieldGet(this,_Connection_startKeepingConnectionAlive,"f").call(this,this.ws),"f")})),this.sendChatMessage=e=>{var t;if(!e)return;const i=JSON.stringify({event:WS_EVENTS.MESSAGE,roomId:__classPrivateFieldGet(this,_Connection_roomId,"f"),user:__classPrivateFieldGet(this,_Connection_userName,"f"),userId:__classPrivateFieldGet(this,_Connection_userId,"f"),value:e});null===(t=this.ws)||void 0===t||t.send(i)},_Connection_sendShapeWithLock.set(this,((e,t=!0)=>{var i;let o=[];Array.isArray(e)?(e.forEach((e=>e.isLocked=t)),o=e):(e.isLocked=t,o=[e]);const s=JSON.stringify({event:t?WS_EVENTS.LOCK_SHAPES:WS_EVENTS.UNLOCK_SHAPES,roomId:__classPrivateFieldGet(this,_Connection_roomId,"f"),user:__classPrivateFieldGet(this,_Connection_userName,"f"),userId:__classPrivateFieldGet(this,_Connection_userId,"f"),value:o.map((e=>JSON.stringify(e.getDeconstructedShapeData())))});null===(i=this.ws)||void 0===i||i.send(s)})),this.lockShapes=e=>{__classPrivateFieldGet(this,_Connection_sendShapeWithLock,"f").call(this,e,!0)},this.unlockShapes=e=>{__classPrivateFieldGet(this,_Connection_sendShapeWithLock,"f").call(this,e,!1)},this.updateStatus=e=>{__classPrivateFieldSet(this,_Connection_status,e,"f"),this.onUpdateConnectionStatus(__classPrivateFieldGet(this,_Connection_status,"f"))},this.getStatus=()=>__classPrivateFieldGet(this,_Connection_status,"f"),this.deleteShapes=e=>{var t;const i=JSON.stringify({event:WS_EVENTS.DELETE_SHAPES,roomId:__classPrivateFieldGet(this,_Connection_roomId,"f"),user:__classPrivateFieldGet(this,_Connection_userName,"f"),userId:__classPrivateFieldGet(this,_Connection_userId,"f"),value:e});null===(t=this.ws)||void 0===t||t.send(i)},this.updateShapes=e=>{var t;let i=[];i=Array.isArray(e)?e:[e];const o=JSON.stringify({event:WS_EVENTS.UPDATE_SHAPES,roomId:__classPrivateFieldGet(this,_Connection_roomId,"f"),user:__classPrivateFieldGet(this,_Connection_userName,"f"),userId:__classPrivateFieldGet(this,_Connection_userId,"f"),value:i.map((e=>JSON.stringify(e.getDeconstructedShapeData())))});null===(t=this.ws)||void 0===t||t.send(o)},this.connect=(e,t=__classPrivateFieldGet(this,_Connection_userName,"f"),i=__classPrivateFieldGet(this,_Connection_url,"f"),o=__classPrivateFieldGet(this,_Connection_port,"f"))=>{this.updateStatus("connecting"),this.disconnect(),__classPrivateFieldGet(this,_Connection_createNewWebSocket,"f").call(this),__classPrivateFieldSet(this,_Connection_userName,t,"f"),__classPrivateFieldSet(this,_Connection_roomId,e,"f"),__classPrivateFieldSet(this,_Connection_url,i,"f"),__classPrivateFieldSet(this,_Connection_port,o,"f")},__classPrivateFieldSet(this,_Connection_url,r,"f"),__classPrivateFieldSet(this,_Connection_port,l,"f"),__classPrivateFieldSet(this,_Connection_userId,nanoid(),"f"),this.onDeleteShapes=e,this.onUpdateShapes=t,this.onGetAllShapes=i,this.onResetEditor=o,this.onNewMessage=n,__classPrivateFieldSet(this,_Connection_onConnected,a,"f"),this.onUpdateConnectionStatus=s,this.updateStatus("disconnected")}}_Connection_userName=new WeakMap,_Connection_chatLog=new WeakMap,_Connection_userId=new WeakMap,_Connection_url=new WeakMap,_Connection_port=new WeakMap,_Connection_roomId=new WeakMap,_Connection_keeper=new WeakMap,_Connection_status=new WeakMap,_Connection_onConnected=new WeakMap,_Connection_parseResponse=new WeakMap,_Connection_startKeepingConnectionAlive=new WeakMap,_Connection_createNewWebSocket=new WeakMap,_Connection_sendShapeWithLock=new WeakMap;const layoutStyle=r$2`:host{height:100%;transition:all 1s;display:flex;flex-direction:column;background-color:#2196f3}#stroke-opacity-input{max-width:'20px'}`,layoutHeaderStyle=r$2`#header{background-color:rgba(255,255,255,.8);width:100%}`,layoutContentStyle=r$2`#content{flex:1 1 auto;display:flex}#draw-container{margin:0;padding:0;top:0;left:0;background-color:#fff;flex:1 1 auto;overflow:auto;display:flex;position:relative}#draw-layer{top:0;left:0;position:absolute}#right-main-section{display:flex;max-width:15%;flex-direction:column;padding:20px 15px 0;background-color:rgba(255,255,255,.8);overflow-y:auto}#preview-layer{top:0;left:0;position:absolute;z-index:1;pointer-events:none}#chat{height:100%;display:flex;flex-direction:column;flex:2 0 auto;border-top:1px solid rgba(0,0,0,.4)}#connection-info{border-top:1px solid rgba(0,0,0,.4);display:flex;flex-direction:column;flex:0 1 20%}#connection-section{display:flex;flex-direction:column}#connection-info #connect-form>label{display:flex}#connection-info #connect-form>label>#connect-form-label{display:flex;flex-direction:column;justify-content:flex-end}#connection-info #connect-form{display:flex;flex-direction:column;align-items:center;padding-bottom:20px}#connection-info #connect-form>:first-child{display:flex;flex-direction:column;width:100%;gap:10px}#connection-info #connect-form>:first-child label{flex:auto;flex-direction:column;display:flex}#chat #chatbox{height:100%;height:-moz-available;height:-webkit-fill-available;height:fill-available;flex:1 .5 auto;overflow:auto;background-color:#fff}#chat #chatbox .chat-entry{display:flex;padding:5px;flex-direction:column;align-items:flex-end}#connect-button-container{display:flex;padding-top:20px;justify-content:center}#room-information{display:flex;flex-direction:column;padding-bottom:20px}#room-information>#disconnect-button-container{padding-top:10px;align-self:flex-start}#connection-info #chatbox .chat-entry:nth-child(2n + 1){background-color:rgba(0,0,0,.1)}#connection-info #chatbox .chat-entry :first-child{align-self:flex-start}#chat #chat-form{display:flex;padding-top:10px}#chat #chat-form #message-field{width:100%}#position-container{border-top:1px solid rgba(0,0,0,.4);display:flex;justify-content:flex-end;padding:10px 10px 0 0}`,drawZoneStyles=r$2`:host{margin:0;padding:0;top:0;left:0;background-color:#fff;flex:1 1 auto;overflow:auto;display:flex;position:relative}#draw-layer{top:0;left:0;position:absolute}#preview-layer{top:0;left:0;position:absolute;z-index:1;pointer-events:none}`;let DrawZone=class extends s{constructor(){super(...arguments),this.height=0,this.width=0}firstUpdated(e){var t;const i=null===(t=null==this?void 0:this.shadowRoot)||void 0===t?void 0:t.getElementById("draw-layer");i.addEventListener("mousemove",(e=>{var t;const o=i.getBoundingClientRect();null===(t=this.onPositionChange)||void 0===t||t.call(this,[e.clientX-o.left,e.clientY-o.top])})),i.addEventListener("mouseout",(e=>{var t;null===(t=this.onPositionChange)||void 0===t||t.call(this,[0,0])}))}render(){return $`<canvas id="draw-layer" height="${this.height}" width="${this.width}"></canvas><canvas id="preview-layer" height="${this.height}" width="${this.width}"></canvas>`}};DrawZone.styles=[drawZoneStyles],__decorate([e({type:Number})],DrawZone.prototype,"height",void 0),__decorate([e({type:Number})],DrawZone.prototype,"width",void 0),__decorate([e({type:String})],DrawZone.prototype,"onPositionChange",void 0),DrawZone=__decorate([n$1("draw-zone")],DrawZone);const positionInformationStyles=r$2`:host{display:flex;padding:5px 10px;border-top:1px solid rgba(0,0,0,.3);border-bottom:1px solid rgba(0,0,0,.3);background-color:rgba(255,255,255,.8)}`;let PositionInformation=class extends s{constructor(){super(...arguments),this.render=()=>{var e,t,i,o;return $`<span id="position">${"x: "+(null!==(t=null===(e=this.position)||void 0===e?void 0:e[0])&&void 0!==t?t:0)+" - y: "+(null!==(o=null===(i=this.position)||void 0===i?void 0:i[1])&&void 0!==o?o:0)}</span>`}}};PositionInformation.styles=[positionInformationStyles],__decorate([e({type:Array})],PositionInformation.prototype,"position",void 0),PositionInformation=__decorate([n$1("position-information")],PositionInformation);const toolBoxButtonStyles=r$2`:host{display:flex}button{aspect-ratio:1;border-radius:0;border:1px solid #000;background-color:#fff;padding:5px;display:flex;flex-shrink:2;justify-content:center;align-items:center}button>img{aspect-ratio:1;max-height:35px}button[isActive=false]{border:1px solid grey}button:hover,button[isActive=true]{border:1px solid #00f;background-color:#0ff}button[disabled]{border:1px solid grey;background-color:grey}.tooltip{text-decoration:none;position:relative}.tooltip span{color:#fff;position:fixed;visibility:hidden;opacity:0;transition:opacity .3s}.tooltip:hover span{border-radius:5px;padding:10px;background-color:#555;visibility:visible;overflow:hidden;opacity:1;z-index:100}`;r$2``;let ToolboxButton=class extends s{constructor(e){super(),e&&(this.buttonId=e.buttonId,this.onClick=e.onClick,this.toolName=e.toolName,this.icon=e.icon,this.disabled=e.disabled)}firstUpdated(){var e;const t=null===(e=this.shadowRoot)||void 0===e?void 0:e.getElementById("button-tooltip");if(t){const e=t.querySelector("#tooltiptext");null==t||t.addEventListener("mousemove",(i=>{if(t.matches(":hover")){const t=i.clientX,o=i.clientY;e&&(e.style.top=o+20+"px",e.style.left=t+15+"px")}}))}}render(){var e,t,i,o;return $`<div class="tooltip" id="button-tooltip"><button id="${null!==(e=this.buttonId)&&void 0!==e?e:this.toolName+Date.now().toString()}" @click="${()=>{var e;return this.buttonId&&(null===(e=this.onClick)||void 0===e?void 0:e.call(this,this.buttonId))}}" .disabled="${null!==(t=this.disabled)&&void 0!==t&&t}">${this.icon?$`<img alt="${null!==(i=this.toolName)&&void 0!==i?i:"tool"}" class="${(null!==(o=this.className)&&void 0!==o?o:"")+"tool-icon"}" onerror="${`this.onerror = null; this.src="public/images/${this.icon[1]}"`}" src="${this.icon[0]+this.icon[1]}">`:this.toolName}</button> <span id="tooltiptext">${this.toolName}</span></div>`}};ToolboxButton.styles=[toolBoxButtonStyles],__decorate([e({type:String})],ToolboxButton.prototype,"buttonId",void 0),__decorate([e()],ToolboxButton.prototype,"onClick",void 0),__decorate([e({type:String})],ToolboxButton.prototype,"toolName",void 0),__decorate([e({type:Array})],ToolboxButton.prototype,"icon",void 0),__decorate([e({type:Boolean})],ToolboxButton.prototype,"disabled",void 0),ToolboxButton=__decorate([n$1("toolbox-button")],ToolboxButton);const connectionSectionStyles=r$2`:host{display:flex;flex-direction:column}:host([status=connected]) connect-form{display:none}:host([status=connecting]) room-information,:host([status=disconnected]) room-information{display:none}#chat #chatbox{height:100%;height:-moz-available;height:-webkit-fill-available;height:fill-available;flex:1 .5 auto;overflow:auto;background-color:#fff}#chat #chatbox .chat-entry{display:flex;padding:5px;flex-direction:column;align-items:flex-end}#connect-button-container{display:flex;padding-top:20px;justify-content:center}#room-information{display:flex;flex-direction:column;padding-bottom:20px}#room-information>#disconnect-button-container{padding-top:10px;align-self:flex-start}:host #chatbox .chat-entry:nth-child(2n + 1){background-color:rgba(0,0,0,.1)}:host #chatbox .chat-entry :first-child{align-self:flex-start}#chat #chat-form{display:flex;padding-top:10px}#chat #chat-form #message-field{width:100%}`,chatStyles=r$2`:host{display:flex;flex-direction:column;height:100%}:host #chatbox .chat-entry:nth-child(2n + 1){background-color:rgba(0,0,0,.1)}:host #chatbox{height:15em;overflow-y:auto;background-color:#fff}:host #chatbox .chat-entry{display:flex;justify-content:space-between}:host #chatbox .chat-entry div{display:flex;max-width:50%;overflow-wrap:anywhere}:host #chatbox .chat-entry :first-child{align-self:flex-start}:host #chat-form{display:flex;padding-top:10px}:host #chat-form #message-field{width:100%}`;let Chat=class extends s{constructor(){super(...arguments),this.chatLog=[],this.isDisabled=!0,this.handleSendMessage=()=>{var e,t,i;const o=null===(t=null===(e=this.shadowRoot)||void 0===e?void 0:e.getElementById("message-field"))||void 0===t?void 0:t.value;null===(i=this.onSendMessage)||void 0===i||i.call(this,o)}}updated(e){var t,i,o,s,n,a,r,l;e.has("isDisabled")&&(this.isDisabled?(null===(i=null===(t=this.shadowRoot)||void 0===t?void 0:t.getElementById("message-field"))||void 0===i||i.setAttribute("disabled",""),null===(s=null===(o=this.shadowRoot)||void 0===o?void 0:o.getElementById("send-message-button"))||void 0===s||s.setAttribute("disabled","")):(null===(a=null===(n=this.shadowRoot)||void 0===n?void 0:n.getElementById("message-field"))||void 0===a||a.removeAttribute("disabled"),null===(l=null===(r=this.shadowRoot)||void 0===r?void 0:r.getElementById("send-message-button"))||void 0===l||l.removeAttribute("disabled")))}render(){var e;return $`<h3>Chat</h3><div id="chatbox">${null===(e=this.chatLog)||void 0===e?void 0:e.map((e=>$`<div class="chat-entry"><div>${e.userName}:</div><div>${e.message}</div></div>`))}</div><div id="chat-form"><input id="message-field" type="text" placeholder="Message..."> <button id="send-message-button" @click="${this.handleSendMessage}">Send</button></div>`}};Chat.styles=[chatStyles],__decorate([e({type:Array})],Chat.prototype,"chatLog",void 0),__decorate([e()],Chat.prototype,"onSendMessage",void 0),__decorate([e({type:Boolean})],Chat.prototype,"isDisabled",void 0),Chat=__decorate([n$1("chat-section")],Chat);const roomInformationStyles=r$2`:host{display:flex;flex-direction:column;padding-bottom:20px}:host>#disconnect-button-container{padding-top:10px;align-self:flex-start}`;let RoomInformation=class extends s{constructor(){super(...arguments),this.userName="",this.roomId=""}render(){return $`<div>Connected as ${this.userName}<br>Room ID: ${this.roomId}</div><div id="disconnect-button-container"><button @click="${this.onLeaveRoom}">Disconnect</button></div>`}};RoomInformation.styles=[roomInformationStyles],__decorate([e({type:String})],RoomInformation.prototype,"userName",void 0),__decorate([e({type:String})],RoomInformation.prototype,"roomId",void 0),__decorate([e()],RoomInformation.prototype,"onLeaveRoom",void 0),RoomInformation=__decorate([n$1("room-information")],RoomInformation);const connectFormStyles=r$2`:host label{display:flex}:host label>#connect-form-label{display:flex;flex-direction:column;justify-content:flex-end}:host{display:flex;flex-direction:column;align-items:center;padding-bottom:20px}:host>:first-child{display:flex;flex-direction:column;width:100%;gap:10px}:host>:first-child label{flex:auto;flex-direction:column;display:flex}:host #connect-button-container{display:flex;padding-top:20px;justify-content:center}`;var _ConnectForm_handleJoinRoom,_ConnectForm_handleRoomIdChange,_ConnectForm_handleUserNameChange;let ConnectForm=class extends s{constructor(){super(...arguments),_ConnectForm_handleJoinRoom.set(this,(()=>{var e;const t=this.userName,i=this.roomId;null===(e=this.onJoinRoom)||void 0===e||e.call(this,{userName:t,roomId:i})})),_ConnectForm_handleRoomIdChange.set(this,(e=>{var t,i;this.roomId=null!==(i=null===(t=e.target)||void 0===t?void 0:t.value)&&void 0!==i?i:this.roomId})),_ConnectForm_handleUserNameChange.set(this,(e=>{var t,i;this.userName=null!==(i=null===(t=e.target)||void 0===t?void 0:t.value)&&void 0!==i?i:this.userName}))}render(){var e;return $`<div><label><div id="username-form-label">Username:</div><input @change="${__classPrivateFieldGet(this,_ConnectForm_handleUserNameChange,"f")}" id="user" type="text" maxlength="10" placeholder="${null!==(e=this.userName)&&void 0!==e?e:""}"></label> <label><div id="connect-form-label">Room ID:</div><input @change="${__classPrivateFieldGet(this,_ConnectForm_handleRoomIdChange,"f")}" id="room" type="text"></label></div><div id="connect-button-container"><button @click="${__classPrivateFieldGet(this,_ConnectForm_handleJoinRoom,"f")}">Connect</button></div>`}};_ConnectForm_handleJoinRoom=new WeakMap,_ConnectForm_handleRoomIdChange=new WeakMap,_ConnectForm_handleUserNameChange=new WeakMap,ConnectForm.styles=[connectFormStyles],__decorate([e()],ConnectForm.prototype,"onJoinRoom",void 0),__decorate([e({type:String})],ConnectForm.prototype,"userName",void 0),__decorate([e({type:String})],ConnectForm.prototype,"roomId",void 0),ConnectForm=__decorate([n$1("connect-form")],ConnectForm);let ConnectionSection=class extends s{constructor(){super(...arguments),this.userName="user_"+nanoid(5),this.roomId="",this.chatLog=[]}render(){return $`<h3>Connection</h3><connect-form .roomId="${this.roomId}" .userName="${this.userName}" .onJoinRoom="${this.onJoinRoom}"></connect-form><room-information .onLeaveRoom="${this.onLeaveRoom}" .userName="${this.userName}" .roomId="${this.roomId}"></room-information><chat-section .onSendMessage="${this.onSendMessage}" .chatLog="${this.chatLog}" .isDisabled="${"connecting"===this.status||"disconnected"===this.status}"></chat-section>`}};ConnectionSection.styles=[connectionSectionStyles],__decorate([e({type:String})],ConnectionSection.prototype,"userName",void 0),__decorate([e({type:String})],ConnectionSection.prototype,"roomId",void 0),__decorate([e({type:String,reflect:!0})],ConnectionSection.prototype,"status",void 0),__decorate([e({type:Array})],ConnectionSection.prototype,"chatLog",void 0),__decorate([e()],ConnectionSection.prototype,"onJoinRoom",void 0),__decorate([e()],ConnectionSection.prototype,"onLeaveRoom",void 0),__decorate([e()],ConnectionSection.prototype,"onSendMessage",void 0),ConnectionSection=__decorate([n$1("connection-section")],ConnectionSection);const dialogSectionStyles=r$2`:host{display:flex;gap:5px;padding:5px;background-color:rgba(255,255,255,.8)}#on-save-button,#open-svg-button{border:1px solid grey;background-color:#fff;padding:10px 15px}#on-save-button:hover,#open-svg-button:hover{background-color:#0ff}#on-save-button>input{display:none}`;var _DialogSection_readerEventHandler;let DialogSection=class extends s{constructor(){super(...arguments),_DialogSection_readerEventHandler.set(this,(e=>{var t,i;try{const o=null===(t=e.target)||void 0===t?void 0:t.result;if("string"==typeof o){const e=new DOMParser;null===(i=this.onSelectSvgFile)||void 0===i||i.call(this,e.parseFromString(o,"image/svg+xml"))}}catch(e){alert("SVG Element count not be imported")}})),this.handleSelectFile=e=>{const t=e.target.files,i=null==t?void 0:t[0];if(!i)return;const o=new FileReader;o.addEventListener("load",__classPrivateFieldGet(this,_DialogSection_readerEventHandler,"f")),e.target.value="",o.readAsText(i)}}render(){return $`<label id="open-svg-button">Open <input id="open-file" type="file" hidden @input="${this.handleSelectFile}" accept="image/svg+xml"></label> <label id="on-save-button">Save <input type="button" id="save" @click="${this.onSave}"></label>`}};_DialogSection_readerEventHandler=new WeakMap,DialogSection.styles=[dialogSectionStyles],__decorate([e()],DialogSection.prototype,"onSelectSvgFile",void 0),__decorate([e()],DialogSection.prototype,"onSave",void 0),DialogSection=__decorate([n$1("dialog-section")],DialogSection);const fontCheck=new Set(["Arial","Arial Black","Bahnschrift","Calibri","Cambria","Cambria Math","Candara","Comic Sans MS","Consolas","Constantia","Corbel","Courier New","Ebrima","Franklin Gothic Medium","Gabriola","Gadugi","Georgia","HoloLens MDL2 Assets","Impact","Ink Free","Javanese Text","Leelawadee UI","Lucida Console","Lucida Sans Unicode","Malgun Gothic","Marlett","Microsoft Himalaya","Microsoft JhengHei","Microsoft New Tai Lue","Microsoft PhagsPa","Microsoft Sans Serif","Microsoft Tai Le","Microsoft YaHei","Microsoft Yi Baiti","MingLiU-ExtB","Mongolian Baiti","MS Gothic","MV Boli","Myanmar Text","Nirmala UI","Palatino Linotype","Segoe MDL2 Assets","Segoe Print","Segoe Script","Segoe UI","Segoe UI Historic","Segoe UI Emoji","Segoe UI Symbol","SimSun","Sitka","Sylfaen","Symbol","Tahoma","Times New Roman","Trebuchet MS","Verdana","Webdings","Wingdings","Yu Gothic","American Typewriter","Andale Mono","Arial","Arial Black","Arial Narrow","Arial Rounded MT Bold","Arial Unicode MS","Avenir","Avenir Next","Avenir Next Condensed","Baskerville","Big Caslon","Bodoni 72","Bodoni 72 Oldstyle","Bodoni 72 Smallcaps","Bradley Hand","Brush Script MT","Chalkboard","Chalkboard SE","Chalkduster","Charter","Cochin","Comic Sans MS","Copperplate","Courier","Courier New","Didot","DIN Alternate","DIN Condensed","Futura","Geneva","Georgia","Gill Sans","Helvetica","Helvetica Neue","Herculanum","Hoefler Text","Impact","Lucida Grande","Luminari","Marker Felt","Menlo","Microsoft Sans Serif","Monaco","Noteworthy","Optima","Palatino","Papyrus","Phosphate","Rockwell","Savoye LET","SignPainter","Skia","Snell Roundhand","Tahoma","Times","Times New Roman","Trattatello","Trebuchet MS","Verdana","Zapfino"].sort()),getFonts=()=>__awaiter(void 0,void 0,void 0,(function*(){yield document.fonts.ready;const e=new Set;for(const t of fontCheck.values())document.fonts.check(`12px "${t}"`)&&e.add(t);return e})),footerFieldsStyles=r$2`:host{display:flex;flex-direction:column;padding:10px 0;border-top:1px solid rgba(0,0,0,.3);border-bottom:1px solid rgba(0,0,0,.3);background-color:rgba(255,255,255,.8)}:host #footer-input{border:none;flex:2 1 auto;display:flex;width:100%;gap:20px;display:flex}:host #footer-input #left-input-section{display:flex;flex-direction:column;gap:5px}:host #footer-input #right-input-section{visibility:hidden;border:none;background-color:inherit;border-left:1px solid rgba(0,0,0,.3);display:flex;flex-direction:column;gap:5px}:host #footer-input-column{display:flex;flex-direction:column}:host #footer-submit-button{width:100%;display:flex;justify-content:flex-end}`;var _FooterFields_handleSVGParamChange;let FooterFields=class extends s{constructor(){super(),_FooterFields_handleSVGParamChange.set(this,((e,t)=>{var i,o,s,n,a,r,l,d,h,c,_,p,u;let v;const f=[SVGParamFieldID.FILL_COLOR,SVGParamFieldID.FILL_OPACITY],m=[SVGParamFieldID.STROKE_COLOR,SVGParamFieldID.STROKE_OPACITY];if([...f,...m].includes(t)){let e,h;m.includes(t)?(e=null===(o=null===(i=this.shadowRoot)||void 0===i?void 0:i.getElementById(SVGParamFieldID.STROKE_OPACITY))||void 0===o?void 0:o.value,h=null===(n=null===(s=this.shadowRoot)||void 0===s?void 0:s.getElementById(SVGParamFieldID.STROKE_COLOR))||void 0===n?void 0:n.value,v=hexToRGBA(null!=h?h:"#000000",e)):(e=null===(r=null===(a=this.shadowRoot)||void 0===a?void 0:a.getElementById(SVGParamFieldID.FILL_OPACITY))||void 0===r?void 0:r.value,h=null===(d=null===(l=this.shadowRoot)||void 0===l?void 0:l.getElementById(SVGParamFieldID.FILL_COLOR))||void 0===d?void 0:d.value,v=hexToRGBA(null!=h?h:"#000000",e))}else SVGParamFieldID.LINE_DASH===t?(v=null===(c=null===(h=this.shadowRoot)||void 0===h?void 0:h.getElementById(SVGParamFieldID.LINE_DASH))||void 0===c?void 0:c.value.trim().split(/[\s,]+/).filter((e=>!!e)).map((e=>parseInt(e))),v.some((e=>!isFinite(e)))&&(v=[0])):v=null===(p=null===(_=this.shadowRoot)||void 0===_?void 0:_.getElementById(t))||void 0===p?void 0:p.value;null===(u=this.onSVGParamChange)||void 0===u||u.call(this,e,v)})),__awaiter(void 0,void 0,void 0,(function*(){yield document.fonts.ready;const e=new Set;for(const t of fontCheck.values())document.fonts.check(`12px "${t}"`)&&e.add(t);return e})).then((e=>this.availableFonts=e))}render(){return $`<fieldset id="footer-input"><div id="left-input-section"><div><label>Stroke width: <input type="number" id="stroke-width-input" @input="${()=>{var e;return null===(e=__classPrivateFieldGet(this,_FooterFields_handleSVGParamChange,"f"))||void 0===e?void 0:e.call(this,"strokeWidth",SVGParamFieldID.STROKE_WIDTH)}}"></label> <label>Line dash: <input type="text" id="line-dash-input" placeholder="3,3,3,12..." @input="${()=>{var e;return null===(e=__classPrivateFieldGet(this,_FooterFields_handleSVGParamChange,"f"))||void 0===e?void 0:e.call(this,"lineDash",SVGParamFieldID.LINE_DASH)}}"></label> <label>Linecap: <select @input="${()=>{var e;return null===(e=__classPrivateFieldGet(this,_FooterFields_handleSVGParamChange,"f"))||void 0===e?void 0:e.call(this,"lineCap",SVGParamFieldID.LINE_CAP)}}" id="line-cap-input"><option value="round">Round edge</option><option value="butt">Flat edge</option></select></label></div><div id="footer-input-column"><div><label>Color: <input type="color" id="stroke-color-input" @change="${()=>{var e;return null===(e=__classPrivateFieldGet(this,_FooterFields_handleSVGParamChange,"f"))||void 0===e?void 0:e.call(this,"stroke",SVGParamFieldID.STROKE_COLOR)}}"></label> <label>Opacity: <input type="range" min="0" step="0.1" max="1" @input="${e=>{var t;updateNextSiblingValue(e),null===(t=__classPrivateFieldGet(this,_FooterFields_handleSVGParamChange,"f"))||void 0===t||t.call(this,"stroke",SVGParamFieldID.STROKE_OPACITY)}}"> <input id="stroke-opacity-input" type="number" @change="${e=>{var t;updatePreviousSiblingValue(e),null===(t=__classPrivateFieldGet(this,_FooterFields_handleSVGParamChange,"f"))||void 0===t||t.call(this,"stroke",SVGParamFieldID.STROKE_OPACITY)}}"></label></div><div><label>Fill: <input type="color" id="fill-color-input" @input="${()=>{var e;return null===(e=__classPrivateFieldGet(this,_FooterFields_handleSVGParamChange,"f"))||void 0===e?void 0:e.call(this,"fill",SVGParamFieldID.FILL_COLOR)}}"></label> <label>Opacity: <input type="range" min="0" max="1" step="0.01" @input="${e=>{var t;updateNextSiblingValue(e),null===(t=__classPrivateFieldGet(this,_FooterFields_handleSVGParamChange,"f"))||void 0===t||t.call(this,"fill",SVGParamFieldID.FILL_OPACITY)}}"> <input id="fill-opacity-input" type="number" @change="${e=>{var t;updatePreviousSiblingValue(e),null===(t=__classPrivateFieldGet(this,_FooterFields_handleSVGParamChange,"f"))||void 0===t||t.call(this,"fill",SVGParamFieldID.FILL_OPACITY)}}"></label></div></div></div><div id="right-input-section"><label>Font size:<input type="number" id="text-font-size-input" @input="${()=>{var e;return null===(e=__classPrivateFieldGet(this,_FooterFields_handleSVGParamChange,"f"))||void 0===e?void 0:e.call(this,"fontSize",SVGParamFieldID.TEXT_FONT_SIZE)}}"></label> <label>Font family: <select id="text-font-family-input" @input="${()=>{var e;return null===(e=__classPrivateFieldGet(this,_FooterFields_handleSVGParamChange,"f"))||void 0===e?void 0:e.call(this,"fontFamily",SVGParamFieldID.TEXT_FONT_FAMILY)}}">${this.availableFonts&&Array.from(this.availableFonts).map((e=>$`<option value="${e}">${e}</option>`))}</select></label> <label>Text: <input type="text" id="text-input" @input="${()=>{var e;return null===(e=__classPrivateFieldGet(this,_FooterFields_handleSVGParamChange,"f"))||void 0===e?void 0:e.call(this,"text",SVGParamFieldID.TEXT)}}"></label></div></fieldset>`}};_FooterFields_handleSVGParamChange=new WeakMap,FooterFields.styles=[footerFieldsStyles],__decorate([t()],FooterFields.prototype,"availableFonts",void 0),__decorate([e()],FooterFields.prototype,"onSVGParamChange",void 0),FooterFields=__decorate([n$1("footer-fields")],FooterFields);const toolBoxStyles=r$2`:host{display:flex;justify-content:center;padding-bottom:10px}:host>#column-wrapper{background-color:rgba(255,255,255,.8);display:flex;flex-wrap:wrap;gap:5px;padding:20px;justify-content:center;transition:width 1s,height 1s}.row{display:flex;justify-content:center;width:30%}.row>toolbox-button{display:flex;aspect-ratio:1;max-height:50px;justify-content:center;align-items:center}`;let ToolBox=class extends s{constructor(){super(...arguments),this.tools=[]}render(){var e;return $`<div id="column-wrapper">${null===(e=this.tools)||void 0===e?void 0:e.map((e=>$`<span class="row"><toolbox-button id="${"tool-box-button-"+e.buttonId}" .onClick="${e.onClick}" .buttonId="${e.buttonId}" .toolName="${e.toolName}" .icon="${e.icon}" .disabled="${e.disabled}"></toolbox-button></span>`))}</div>`}};ToolBox.styles=toolBoxStyles,__decorate([e({type:Array,hasChanged:(e,t)=>JSON.stringify(e)!==JSON.stringify(t)})],ToolBox.prototype,"tools",void 0),ToolBox=__decorate([n$1("tool-box")],ToolBox);const pathToFiles="https://inflameous171.github.io/svgeditor/public/images/",getToolboxButtonsProps=e=>[{toolName:"Draw Tool",class:"draw-ool",onClick:()=>e(Tools_List.DRAW),icon:[pathToFiles,"draw.svg"],buttonId:Tools_List.DRAW},{toolName:"Line Tool",onClick:()=>e(Tools_List.LINE),icon:[pathToFiles,"line.svg"],buttonId:Tools_List.LINE},{toolName:"Rect Tool",icon:[pathToFiles,"rectangle.svg"],onClick:()=>e(Tools_List.RECT),buttonId:Tools_List.RECT},{toolName:"Ellipse Tool - Hold CTRL for circle mode",onClick:()=>e(Tools_List.ELLIPSE),icon:[pathToFiles,"ellipse.svg"],buttonId:Tools_List.ELLIPSE},{toolName:"Text Tool",onClick:()=>e(Tools_List.TEXT),icon:[pathToFiles,"text.svg"],buttonId:Tools_List.TEXT},{toolName:"Select Tool",onClick:()=>e(Tools_List.SELECT),icon:[pathToFiles,"select.svg"],buttonId:Tools_List.SELECT},{toolName:"Move Tool",onClick:()=>e(Tools_List.MOVE),icon:[pathToFiles,"move.svg"],buttonId:Tools_List.MOVE,disabled:!0},{toolName:"Delete",onClick:()=>e(Tools_List.DELETE),icon:[pathToFiles,"delete.svg"],buttonId:Tools_List.DELETE},{toolName:"Unselect",onClick:()=>e(null),icon:[pathToFiles,"unselect.svg"],buttonId:Tools_List.UNSELECT}];let EditorTemplate=class extends s{constructor(e){var t,i;super(),this.width=0,this.height=0,this.editor=null,this.chatLog=[],this.connectionStatus=null!==(i=null===(t=this.connection)||void 0===t?void 0:t.getStatus())&&void 0!==i?i:"disconnected",e&&(this.onSelectTool=e.onSelectTool,this.onMousePositionChange=e.onMousePositionChange,this.onLeaveRoom=e.onLeaveRoom,this.onJoinRoom=e.onJoinRoom,this.width=e.width,this.height=e.height,this.editor=e.editor,this.position=e.position,this.connection=e.connection,this.chatLog=e.chatLog)}render(){var e,t,i,o,s,n,a,r;const l=(d=e=>{var t;null===(t=this.onSelectTool)||void 0===t||t.call(this,e)},[{toolName:"Draw Tool",class:"draw-ool",onClick:()=>d(Tools_List.DRAW),icon:[pathToFiles,"draw.svg"],buttonId:Tools_List.DRAW},{toolName:"Line Tool",onClick:()=>d(Tools_List.LINE),icon:[pathToFiles,"line.svg"],buttonId:Tools_List.LINE},{toolName:"Rect Tool",icon:[pathToFiles,"rectangle.svg"],onClick:()=>d(Tools_List.RECT),buttonId:Tools_List.RECT},{toolName:"Ellipse Tool - Hold CTRL for circle mode",onClick:()=>d(Tools_List.ELLIPSE),icon:[pathToFiles,"ellipse.svg"],buttonId:Tools_List.ELLIPSE},{toolName:"Text Tool",onClick:()=>d(Tools_List.TEXT),icon:[pathToFiles,"text.svg"],buttonId:Tools_List.TEXT},{toolName:"Select Tool",onClick:()=>d(Tools_List.SELECT),icon:[pathToFiles,"select.svg"],buttonId:Tools_List.SELECT},{toolName:"Move Tool",onClick:()=>d(Tools_List.MOVE),icon:[pathToFiles,"move.svg"],buttonId:Tools_List.MOVE,disabled:!0},{toolName:"Delete",onClick:()=>d(Tools_List.DELETE),icon:[pathToFiles,"delete.svg"],buttonId:Tools_List.DELETE},{toolName:"Unselect",onClick:()=>d(null),icon:[pathToFiles,"unselect.svg"],buttonId:Tools_List.UNSELECT}]);var d;return $`<div id="content"><draw-zone id="draw-zone" .height="${this.height}" .width="${this.width}" .onPositionChange="${this.onMousePositionChange}"></draw-zone><div id="right-main-section"><tool-box id="tool-box" .tools="${l}"></tool-box><connection-section .status="${this.connectionStatus}" .onJoinRoom="${this.onJoinRoom}" .onLeaveRoom="${this.onLeaveRoom}" .onSendMessage="${null===(e=this.connection)||void 0===e?void 0:e.sendChatMessage}" .userName="${null!==(i=null===(t=this.connection)||void 0===t?void 0:t.getUserName())&&void 0!==i?i:"user_"+nanoid(6)}" .roomId="${null!==(s=null===(o=this.connection)||void 0===o?void 0:o.getRoom())&&void 0!==s?s:""}" .chatLog="${this.chatLog}"></connection-section></div></div><dialog-section .onSave="${null===(n=this.editor)||void 0===n?void 0:n.onSave}" .onSelectSvgFile="${null===(a=this.editor)||void 0===a?void 0:a.onImportSVG}"></dialog-section><div id="footer"><footer-fields .onSVGParamChange="${null===(r=this.editor)||void 0===r?void 0:r.setShapeParam}"></footer-fields><position-information .position="${this.position}"></position-information></div>`}};var _SVGEditor_updateChatLog,_SVGEditor_updateConnection,_SVGEditor_handleSelectTool,_SVGEditor_handleJoinRoom,_SVGEditor_handleLeaveRoom,_SVGEditor_updateResize,_SVGEditor_handlePositionChange;EditorTemplate.styles=[layoutStyle,layoutHeaderStyle,layoutContentStyle],__decorate([e({type:Object})],EditorTemplate.prototype,"onSelectTool",void 0),__decorate([e({type:Object})],EditorTemplate.prototype,"onJoinRoom",void 0),__decorate([e({type:Object})],EditorTemplate.prototype,"onLeaveRoom",void 0),__decorate([e({type:Object})],EditorTemplate.prototype,"onMousePositionChange",void 0),__decorate([e({type:Number})],EditorTemplate.prototype,"width",void 0),__decorate([e({type:Number})],EditorTemplate.prototype,"height",void 0),__decorate([e({type:Object})],EditorTemplate.prototype,"editor",void 0),__decorate([e({type:Array})],EditorTemplate.prototype,"position",void 0),__decorate([e({type:Object})],EditorTemplate.prototype,"connection",void 0),__decorate([e({type:Array})],EditorTemplate.prototype,"chatLog",void 0),__decorate([e({type:String})],EditorTemplate.prototype,"connectionStatus",void 0),EditorTemplate=__decorate([n$1("editor-template")],EditorTemplate);let SVGEditor=class extends s{constructor(){var e,t;super(),this.width=0,this.height=0,this.editor=null,this.chatLog=[],this.connectionStatus=null!==(t=null===(e=this.connection)||void 0===e?void 0:e.getStatus())&&void 0!==t?t:"disconnected",_SVGEditor_updateChatLog.set(this,(e=>{this.chatLog=[...e]})),_SVGEditor_updateConnection.set(this,(e=>{this.connectionStatus=e})),_SVGEditor_handleSelectTool.set(this,(e=>{var t;null===(t=this.editor)||void 0===t||t.onSelectTool(e)})),_SVGEditor_handleJoinRoom.set(this,(e=>{const{userName:t,roomId:i}=e;this.editor&&i&&this.connection&&(this.connection.connect(i,t),document.title=document.title+" | Room:"+i)})),_SVGEditor_handleLeaveRoom.set(this,(()=>{var e;null===(e=this.connection)||void 0===e||e.disconnect(),document.title="SVG Editor"})),_SVGEditor_updateResize.set(this,(()=>{this.width=window.innerWidth,this.height=window.innerHeight})),_SVGEditor_handlePositionChange.set(this,(e=>this.position=e)),this.isLoading=!0}firstUpdated(){__classPrivateFieldGet(this,_SVGEditor_updateResize,"f").call(this)}updated(e){var t,i,o,s,n;const a=null===(t=this.shadowRoot)||void 0===t?void 0:t.getElementById("editor");if(!this.editor&&this.editor!==e.get("editor")){const e=null===(i=a.shadowRoot)||void 0===i?void 0:i.getElementById("draw-zone"),t=null===(o=null==e?void 0:e.shadowRoot)||void 0===o?void 0:o.getElementById("draw-layer"),r=null===(s=null==e?void 0:e.shadowRoot)||void 0===s?void 0:s.getElementById("preview-layer");if(t&&r){new ResizeObserver(__classPrivateFieldGet(this,_SVGEditor_updateResize,"f")).observe(t);const e=null===(n=a.shadowRoot)||void 0===n?void 0:n.querySelector("footer-fields");this.editor=new Editor(t,r,[r.offsetLeft,r.offsetTop],a,e),this.connection=new Connection(this.editor.deleteFromShapes,this.editor.updateShapes,this.editor.getAllShapes,this.editor.resetEditor,__classPrivateFieldGet(this,_SVGEditor_updateConnection,"f"),__classPrivateFieldGet(this,_SVGEditor_updateChatLog,"f"),this.editor.setConnection,"localhost","8080")}}this.editor&&this.connection&&(this.isLoading=!1)}render(){return $`<editor-template id="editor" .width="${this.width}" .height="${this.height}" .chatLog="${this.chatLog}" .connection="${this.connection}" .editor="${this.editor}" .connectionStatus="${this.connectionStatus}" .position="${this.position}" .onJoinRoom="${__classPrivateFieldGet(this,_SVGEditor_handleJoinRoom,"f")}" .onLeaveRoom="${__classPrivateFieldGet(this,_SVGEditor_handleLeaveRoom,"f")}" .onMousePositionChange="${__classPrivateFieldGet(this,_SVGEditor_handlePositionChange,"f")}" .onSelectTool="${__classPrivateFieldGet(this,_SVGEditor_handleSelectTool,"f")}"></editor-template>`}};_SVGEditor_updateChatLog=new WeakMap,_SVGEditor_updateConnection=new WeakMap,_SVGEditor_handleSelectTool=new WeakMap,_SVGEditor_handleJoinRoom=new WeakMap,_SVGEditor_handleLeaveRoom=new WeakMap,_SVGEditor_updateResize=new WeakMap,_SVGEditor_handlePositionChange=new WeakMap,SVGEditor.styles=[layoutStyle,layoutHeaderStyle,layoutContentStyle],__decorate([t()],SVGEditor.prototype,"isLoading",void 0),__decorate([t()],SVGEditor.prototype,"width",void 0),__decorate([t()],SVGEditor.prototype,"height",void 0),__decorate([t()],SVGEditor.prototype,"editor",void 0),__decorate([t()],SVGEditor.prototype,"position",void 0),__decorate([t()],SVGEditor.prototype,"connection",void 0),__decorate([t()],SVGEditor.prototype,"chatLog",void 0),__decorate([t()],SVGEditor.prototype,"connectionStatus",void 0),SVGEditor=__decorate([n$1("svg-editor")],SVGEditor);
